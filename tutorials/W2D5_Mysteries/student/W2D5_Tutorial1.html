
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Docutils 0.18.1: http://docutils.sourceforge.net/" name="generator"/>
<title>Tutorial 1: Consciousness — Neuromatch Academy: NeuroAI</title>
<script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
<!-- Loaded before other Sphinx assets -->
<link href="../../../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet"/>
<link href="../../../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet"/>
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet"/>
<link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" rel="preload" type="font/woff2"/>
<link href="../../../_static/pygments.css" rel="stylesheet" type="text/css">
<link href="../../../_static/styles/sphinx-book-theme.css?digest=4ec06e9971c5264fbd345897d5258098f11cc577" rel="stylesheet" type="text/css">
<link href="../../../_static/togglebutton.css" rel="stylesheet" type="text/css">
<link href="../../../_static/copybutton.css" rel="stylesheet" type="text/css">
<link href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" rel="stylesheet" type="text/css">
<link href="../../../_static/sphinx-thebe.css" rel="stylesheet" type="text/css">
<link href="../../../_static/custom.css" rel="stylesheet" type="text/css">
<link href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94" rel="preload"/>
<link as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94" rel="preload"/>
<script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
<script src="../../../_static/jquery.js"></script>
<script src="../../../_static/underscore.js"></script>
<script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
<script src="../../../_static/doctools.js"></script>
<script src="../../../_static/clipboard.min.js"></script>
<script src="../../../_static/copybutton.js"></script>
<script src="../../../_static/scripts/sphinx-book-theme.js?digest=8bf782fb4ee92b3d3646425e50f299c4e1fd152d"></script>
<script>let toggleHintShow = 'Click to show';</script>
<script>let toggleHintHide = 'Click to hide';</script>
<script>let toggleOpenOnPrint = 'true';</script>
<script src="../../../_static/togglebutton.js"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
<script src="../../../_static/design-tabs.js"></script>
<script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
<script async="async" src="../../../_static/sphinx-thebe.js"></script>
<script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
<script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/W2D5_Mysteries/student/W2D5_Tutorial1';</script>
<link href="../../../_static/ai-logo.png" rel="shortcut icon">
<link href="../../../genindex.html" rel="index" title="Index">
<link href="../../../search.html" rel="search" title="Search"/>
<link href="W2D5_Tutorial2.html" rel="next" title="Tutorial 2: Ethics"/>
<link href="W2D5_Intro.html" rel="prev" title="Intro"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="en" name="docsearch:language"/>
</link></link></link></link></link></link></link></link></link></head>
<body data-default-mode="" data-offset="180" data-spy="scroll" data-target="#bd-toc-nav">
<a class="skip-link" href="#main-content">Skip to main content</a>
<input class="sidebar-toggle" id="__primary" name="__primary" type="checkbox"/>
<label class="overlay overlay-primary" for="__primary"></label>
<input class="sidebar-toggle" id="__secondary" name="__secondary" type="checkbox"/>
<label class="overlay overlay-secondary" for="__secondary"></label>
<div class="search-button__wrapper">
<div class="search-button__overlay"></div>
<div class="search-button__search-container">
<form action="../../../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="fa-solid fa-magnifying-glass"></i>
<input aria-label="Search this book..." autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." spellcheck="false" type="search"/>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
</div>
</div>
<nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
<label class="sidebar-toggle primary-toggle" for="__primary">
<span class="fa-solid fa-bars"></span>
</label>
<div id="navbar-start">
<a class="navbar-brand logo" href="../../intro.html">
<img alt="Logo image" class="logo__image only-light" src="../../../_static/ai-logo.png"/>
<img alt="Logo image" class="logo__image only-dark" src="../../../_static/ai-logo.png"/>
</a>
</div>
<div class="col-lg-9 navbar-header-items">
<div class="mr-auto" id="navbar-center">
<div class="navbar-center-item">
<nav class="navbar-nav">
<p aria-label="Site Navigation" aria-level="1" class="sidebar-header-items__title" role="heading">
        Site Navigation
    </p>
<ul class="navbar-nav" id="navbar-main-elements">
<li class="nav-item">
<a class="nav-link nav-internal" href="../../Schedule/schedule_intro.html">
                        Schedule
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../TechnicalHelp/tech_intro.html">
                        Technical Help
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../TechnicalHelp/Links_Policy.html">
                        Quick links and policies
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../prereqs/NeuroAI.html">
                        Prerequisites and preparatory materials for NeuroAI course
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W1D1_Generalization/chapter_title.html">
                        Generalization (W1D1)
                      </a>
</li>
<div class="nav-item dropdown">
<button aria-expanded="false" aria-haspopup="true" class="btn dropdown-toggle nav-item" data-toggle="dropdown" type="button">
                    More
                </button>
<div class="dropdown-menu">
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W1D2_ComparingTasks/chapter_title.html">
                        Comparing Tasks (W1D2)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W1D3_ComparingArtificialAndBiologicalNetworks/chapter_title.html">
                        Comparing Artificial And Biological Networks (W1D3)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W1D5_Microcircuits/chapter_title.html">
                        Microcircuits (W1D5)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W2D1_Macrocircuits/chapter_title.html">
                        Macrocircuits (W2D1)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W2D2_NeuroSymbolicMethods/chapter_title.html">
                        Neuro Symbolic Methods (W2D2)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W2D3_Microlearning/chapter_title.html">
                        Microlearning (W2D3)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W2D4_Macrolearning/chapter_title.html">
                        Macrolearning (W2D4)
                      </a>
</li>
<li class="nav-item current active">
<a class="nav-link nav-internal" href="../chapter_title.html">
                        Mysteries (W2D5)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects/README.html">
                        Introduction
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects/docs/project_guidance.html">
                        Daily guide for projects
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects/docs/continuing_your_project_after_the_course.html">
                        Continuing your project after the course
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects/docs/datasets_overview.html">
                        Project materials
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects/professional_development/README.html">
                        Introduction
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects/professional_development/mentorship_program.html">
                        Mentorship Program
                      </a>
</li>
</div>
</div>
</ul>
</nav>
</div>
</div>
<div id="navbar-end">
<div class="navbar-end-item navbar-persistent--container">
<button aria-label="Search" class="btn btn-sm navbar-btn search-button search-button__button" data-toggle="tooltip" title="Search">
<i class="fa-solid fa-magnifying-glass"></i>
</button>
</div>
<div class="navbar-end-item">
<button aria-label="light/dark" class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" data-toggle="tooltip" title="light/dark">
<span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
<span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
<span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
</div>
<div class="navbar-end-item">
<ul aria-label="Icon Links" class="navbar-nav" id="navbar-icon-links">
</ul>
</div>
</div>
</div>
<div class="navbar-persistent--mobile">
<button aria-label="Search" class="btn btn-sm navbar-btn search-button search-button__button" data-toggle="tooltip" title="Search">
<i class="fa-solid fa-magnifying-glass"></i>
</button>
</div>
<label class="sidebar-toggle secondary-toggle" for="__secondary">
<span class="fa-solid fa-outdent"></span>
</label>
</div>
</nav>
<div class="bd-container">
<div class="bd-container__inner bd-page-width">
<div class="bd-sidebar-primary bd-sidebar">
<div class="sidebar-header-items sidebar-primary__section">
<div class="sidebar-header-items__center">
<div class="navbar-center-item">
<nav class="navbar-nav">
<p aria-label="Site Navigation" aria-level="1" class="sidebar-header-items__title" role="heading">
        Site Navigation
    </p>
<ul class="navbar-nav" id="navbar-main-elements">
<li class="nav-item">
<a class="nav-link nav-internal" href="../../Schedule/schedule_intro.html">
                        Schedule
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../TechnicalHelp/tech_intro.html">
                        Technical Help
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../TechnicalHelp/Links_Policy.html">
                        Quick links and policies
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../prereqs/NeuroAI.html">
                        Prerequisites and preparatory materials for NeuroAI course
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W1D1_Generalization/chapter_title.html">
                        Generalization (W1D1)
                      </a>
</li>
<div class="nav-item dropdown">
<button aria-expanded="false" aria-haspopup="true" class="btn dropdown-toggle nav-item" data-toggle="dropdown" type="button">
                    More
                </button>
<div class="dropdown-menu">
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W1D2_ComparingTasks/chapter_title.html">
                        Comparing Tasks (W1D2)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W1D3_ComparingArtificialAndBiologicalNetworks/chapter_title.html">
                        Comparing Artificial And Biological Networks (W1D3)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W1D5_Microcircuits/chapter_title.html">
                        Microcircuits (W1D5)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W2D1_Macrocircuits/chapter_title.html">
                        Macrocircuits (W2D1)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W2D2_NeuroSymbolicMethods/chapter_title.html">
                        Neuro Symbolic Methods (W2D2)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W2D3_Microlearning/chapter_title.html">
                        Microlearning (W2D3)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../W2D4_Macrolearning/chapter_title.html">
                        Macrolearning (W2D4)
                      </a>
</li>
<li class="nav-item current active">
<a class="nav-link nav-internal" href="../chapter_title.html">
                        Mysteries (W2D5)
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects/README.html">
                        Introduction
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects/docs/project_guidance.html">
                        Daily guide for projects
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects/docs/continuing_your_project_after_the_course.html">
                        Continuing your project after the course
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects/docs/datasets_overview.html">
                        Project materials
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects/professional_development/README.html">
                        Introduction
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects/professional_development/mentorship_program.html">
                        Mentorship Program
                      </a>
</li>
</div>
</div>
</ul>
</nav>
</div>
</div>
<div class="sidebar-header-items__end">
<div class="navbar-end-item">
<button aria-label="light/dark" class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" data-toggle="tooltip" title="light/dark">
<span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
<span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
<span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
</div>
<div class="navbar-end-item">
<ul aria-label="Icon Links" class="navbar-nav" id="navbar-icon-links">
</ul>
</div>
</div>
</div>
<div class="sidebar-start-items sidebar-primary__section">
<div class="sidebar-start-items__item">
<a class="navbar-brand logo" href="../../intro.html">
<img alt="Logo image" class="logo__image only-light" src="../../../_static/ai-logo.png"/>
<img alt="Logo image" class="logo__image only-dark" src="../../../_static/ai-logo.png"/>
</a>
</div>
<div class="sidebar-start-items__item">
<form action="../../../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="fa-solid fa-magnifying-glass"></i>
<input aria-label="Search this book..." autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." spellcheck="false" type="search"/>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
</div>
<div class="sidebar-start-items__item"><nav aria-label="Main" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item navbar-nav active">
<ul class="nav bd-sidenav bd-sidenav__home-link">
<li class="toctree-l1">
<a class="reference internal" href="../../intro.html">
                    Introduction
                </a>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Schedule/schedule_intro.html">Schedule</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Schedule/daily_schedules.html">General schedule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Schedule/shared_calendars.html">Shared calendars</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Schedule/timezone_widget.html">Timezone widget</a></li>
</ul>
</input></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../TechnicalHelp/tech_intro.html">Technical Help</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../TechnicalHelp/Jupyterbook.html">Using jupyterbook</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../TechnicalHelp/Tutorial_colab.html">Using Google Colab</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../TechnicalHelp/Tutorial_kaggle.html">Using Kaggle</a></li>
</ul>
</input></li>
<li class="toctree-l2"><a class="reference internal" href="../../TechnicalHelp/Discord.html">Using discord</a></li>
</ul>
</input></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../TechnicalHelp/Links_Policy.html">Quick links and policies</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../prereqs/NeuroAI.html">Prerequisites and preparatory materials for NeuroAI course</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Foundations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../W1D1_Generalization/chapter_title.html">Generalization (W1D1)</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../W1D1_Generalization/student/W1D1_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D1_Generalization/student/W1D1_Tutorial1.html">Tutorial 1: Generalization in AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D1_Generalization/student/W1D1_Tutorial2.html">Tutorial 2: Generalization in Neuroscience</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D1_Generalization/student/W1D1_Tutorial3.html">Tutorial 3: Generalization in Cognitive Science</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D1_Generalization/student/W1D1_Outro.html">Daily survey</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D1_Generalization/further_reading.html">Suggested further readings</a></li>
</ul>
</input></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../W1D2_ComparingTasks/chapter_title.html">Comparing Tasks (W1D2)</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../W1D2_ComparingTasks/student/W1D2_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D2_ComparingTasks/student/W1D2_Tutorial1.html">Tutorial 1: Task definition, application, relations and impacts on generalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D2_ComparingTasks/student/W1D2_Tutorial2.html">Tutorial 2: Contrastive learning for object recognition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D2_ComparingTasks/student/W1D2_Tutorial3.html">Tutorial 3: Reinforcement learning across temporal scales</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D2_ComparingTasks/student/W1D2_Outro.html">Daily survey</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D2_ComparingTasks/further_reading.html">Suggested further readings</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../W1D3_ComparingArtificialAndBiologicalNetworks/chapter_title.html">Comparing Artificial And Biological Networks (W1D3)</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../W1D3_ComparingArtificialAndBiologicalNetworks/student/W1D3_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D3_ComparingArtificialAndBiologicalNetworks/student/W1D3_Tutorial1.html">Tutorial 1: Generalization and representational geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D3_ComparingArtificialAndBiologicalNetworks/student/W1D3_Tutorial2.html">Tutorial 2: Computation as transformation of representational geometries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D3_ComparingArtificialAndBiologicalNetworks/student/W1D3_Tutorial3.html">Tutorial 3: Statistical inference on representational geometries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D3_ComparingArtificialAndBiologicalNetworks/student/W1D3_Tutorial4.html">Tutorial 4: Representational geometry &amp; noise</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D3_ComparingArtificialAndBiologicalNetworks/student/W1D3_Tutorial5.html">Bonus Material: Dynamical similarity analysis (DSA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D3_ComparingArtificialAndBiologicalNetworks/student/W1D3_Outro.html">Daily survey</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D3_ComparingArtificialAndBiologicalNetworks/further_reading.html">Suggested further readings</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Architectures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../W1D5_Microcircuits/chapter_title.html">Microcircuits (W1D5)</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../W1D5_Microcircuits/student/W1D5_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D5_Microcircuits/student/W1D5_Tutorial1.html">Tutorial 1: Sparsity and Sparse Coding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D5_Microcircuits/student/W1D5_Tutorial2.html">Tutorial 2: Normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D5_Microcircuits/student/W1D5_Tutorial3.html">Tutorial 3: Attention</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D5_Microcircuits/student/W1D5_Outro.html">Daily survey</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W1D5_Microcircuits/further_reading.html">Suggested further readings</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../W2D1_Macrocircuits/chapter_title.html">Macrocircuits (W2D1)</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../W2D1_Macrocircuits/student/W2D1_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D1_Macrocircuits/student/W2D1_Tutorial1.html">Tutorial 1: Depth vs width</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D1_Macrocircuits/student/W2D1_Tutorial2.html">Tutorial 2: Double descent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D1_Macrocircuits/student/W2D1_Tutorial3.html">Tutorial 3: Neural network modularity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D1_Macrocircuits/student/W2D1_Outro.html">Daily survey</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D1_Macrocircuits/further_reading.html">Suggested further readings</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../W2D2_NeuroSymbolicMethods/chapter_title.html">Neuro Symbolic Methods (W2D2)</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../W2D2_NeuroSymbolicMethods/student/W2D2_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D2_NeuroSymbolicMethods/student/W2D2_Tutorial1.html">Tutorial 1: Basic operations of vector symbolic algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D2_NeuroSymbolicMethods/student/W2D2_Tutorial2.html">Tutorial 2: Learning with structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D2_NeuroSymbolicMethods/student/W2D2_Tutorial3.html">Tutorial 3: Representations in continuous space</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D2_NeuroSymbolicMethods/student/W2D2_Outro.html">Daily survey</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D2_NeuroSymbolicMethods/further_reading.html">Suggested further readings</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../W2D3_Microlearning/chapter_title.html">Microlearning (W2D3)</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../W2D3_Microlearning/student/W2D3_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D3_Microlearning/student/W2D3_Tutorial1.html">Tutorial 1: Microlearning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D3_Microlearning/student/W2D3_Outro.html">Daily survey</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D3_Microlearning/further_reading.html">Suggested further readings</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../W2D4_Macrolearning/chapter_title.html">Macrolearning (W2D4)</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../W2D4_Macrolearning/student/W2D4_Intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D4_Macrolearning/student/W2D4_Tutorial1.html">Tutorial 1: The problem of changing data distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D4_Macrolearning/student/W2D4_Tutorial2.html">Tutorial 2: Continual learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D4_Macrolearning/student/W2D4_Tutorial3.html">Tutorial 3: Meta-learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D4_Macrolearning/student/W2D4_Tutorial4.html">Tutorial 4: Biological meta reinforcement learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D4_Macrolearning/student/W2D4_Tutorial5.html">Tutorial 5: Replay</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D4_Macrolearning/student/W2D4_Outro.html">Daily survey</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../W2D4_Macrolearning/further_reading.html">Suggested further readings</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Mysteries</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../chapter_title.html">Mysteries (W2D5)</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="W2D5_Intro.html">Intro</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Tutorial 1: Consciousness</a></li>
<li class="toctree-l2"><a class="reference internal" href="W2D5_Tutorial2.html">Tutorial 2: Ethics</a></li>
<li class="toctree-l2"><a class="reference internal" href="W2D5_Outro.html">Outro &amp; Daily survey</a></li>
<li class="toctree-l2"><a class="reference internal" href="../further_reading.html">Suggested further readings</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Project Booklet</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../projects/README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../projects/docs/project_guidance.html">Daily guide for projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../projects/docs/continuing_your_project_after_the_course.html">Continuing your project after the course</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../projects/docs/datasets_overview.html">Project materials</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../projects/project-notebooks/Macrocircuits.html">Macrocircuits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../projects/project-notebooks/Microlearning.html">Microlearning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../projects/project-notebooks/ComparingNetworks.html">Comparing Networks</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Professional Development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../projects/professional_development/README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../projects/professional_development/mentorship_program.html">Mentorship Program</a></li>
</ul>
</div>
</nav>
</div>
</div>
<div class="sidebar-end-items sidebar-primary__section">
<div class="sidebar-end-items__item">
</div>
</div>
<div id="rtd-footer-container"></div>
</div>
<main class="bd-main" id="main-content">
<div class="sbt-scroll-pixel-helper"></div>
<div class="bd-content">
<div class="bd-article-container">
<div class="bd-header-article">
<div class="col py-1 d-flex header-article-main">
<div class="header-article__left">
<label class="sidebar-toggle primary-toggle btn btn-sm" data-placement="right" data-toggle="tooltip" for="__primary" title="Toggle primary sidebar">
<span class="fa-solid fa-bars"></span>
</label>
</div>
<div class="header-article__right">
<div class="dropdown dropdown-launch-buttons">
<button aria-expanded="false" aria-label="Launch interactive content" class="btn dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fas fa-rocket"></i>
</button>
<ul class="dropdown-menu">
</ul>
</div>
<button class="btn btn-sm" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="btn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<div class="dropdown dropdown-repository-buttons">
<button aria-expanded="false" aria-label="Source repositories" class="btn dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fab fa-github"></i>
</button>
<ul class="dropdown-menu">
<li><a class="btn btn-sm dropdown-item" data-placement="left" data-toggle="tooltip" href="https://github.com/neuromatch/NeuroAI_Course" target="_blank" title="Source repository">
<span class="btn__icon-container">
<i class="fab fa-github"></i>
</span>
<span class="btn__text-container">repository</span>
</a>

<li><a class="btn btn-sm dropdown-item" data-placement="left" data-toggle="tooltip" href="https://github.com/neuromatch/NeuroAI_Course/issues/new?title=Issue%20on%20page%20%2Ftutorials/W2D5_Mysteries/student/W2D5_Tutorial1.html&amp;body=Your%20issue%20content%20here." target="_blank" title="Open an issue">
<span class="btn__icon-container">
<i class="fas fa-lightbulb"></i>
</span>
<span class="btn__text-container">open issue</span>
</a>

</li></li></ul>
</div>
<div class="dropdown dropdown-download-buttons">
<button aria-expanded="false" aria-label="Download this page" class="btn dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fas fa-download"></i>
</button>
<ul class="dropdown-menu">
<li><a class="btn btn-sm dropdown-item" data-placement="left" data-toggle="tooltip" href="../../../_sources/tutorials/W2D5_Mysteries/student/W2D5_Tutorial1.ipynb" target="_blank" title="Download source file">
<span class="btn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="btn__text-container">.ipynb</span>
</a>

<li>
<button class="btn btn-sm dropdown-item" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
<span class="btn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="btn__text-container">.pdf</span>
</button>

</li></li></ul>
</div>
<label class="sidebar-toggle secondary-toggle btn btn-sm" data-placement="left" data-toggle="tooltip" for="__secondary" title="Toggle secondary sidebar">
<span class="fa-solid fa-list"></span>
</label>
</div>
</div>
</div>
<div class="onlyprint" id="jb-print-docs-body">
<h1>Tutorial 1: Consciousness</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#">
   Tutorial 1: Consciousness
  </a>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#tutorial-objectives">
   Tutorial Objectives
  </a>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#setup">
   Setup
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#install-and-import-feedback-gadget">
     Install and import feedback gadget
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#import-dependencies">
     Import dependencies
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#figure-settings">
     Figure settings
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#helper-functions">
     Helper functions
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#plotting-functions">
     Plotting functions
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#set-device-gpu-or-cpu">
     Set device (GPU or CPU)
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-1-global-neuronal-workspace">
   Section 1: Global Neuronal Workspace
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-1-global-neuronal-workspace">
     Video 1: Global Neuronal Workspace
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#submit-your-feedback">
     Submit your feedback
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-2-global-neuronal-workspace">
     Video 2: Global Neuronal Workspace
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id1">
     Submit your feedback
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-1a-modularity-of-the-mind">
     Section 1a: Modularity Of The Mind
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-3-modularity-of-the-mind">
       Video 3: Modularity Of The Mind
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id2">
       Submit your feedback
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#rims">
       RIMs
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#data-retrieval">
         Data retrieval
        </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id3">
         Submit your feedback
        </a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#discussion-point">
       Discussion point
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id4">
         Submit your feedback
        </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-1b-a-shared-workspace">
     Section 1b: A Shared Workspace
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-4-a-shared-workspace">
       Video 4: A Shared Workspace
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id5">
       Submit your feedback
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise-1-creating-a-shared-workspace">
       Coding Exercise 1: Creating a Shared Workspace
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id6">
         Submit your feedback
        </a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-2-higher-order-assessment-and-metacognition">
   Section 2: Higher order assessment and metacognition
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-5-higher-order-assessment-and-metacognition">
     Video 5: Higher order assessment and metacognition
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id7">
     Submit your feedback
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#second-order-model">
     Second order model
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise-2-developing-a-second-order-network">
       Coding Exercise 2: Developing a Second-Order Network
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id8">
         Submit your feedback
        </a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id9">
       Discussion point
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id10">
         Submit your feedback
        </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-6-second-order-network">
         Video 6: Second Order Network
        </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id11">
         Submit your feedback
        </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#higher-order-state-space-hoss-model">
     Higher Order State Space (HOSS) model
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-7-higher-order-state-spaces">
       Video 7: Higher-Order State Spaces
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id12">
       Submit your feedback
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#model-inference">
       Model inference
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise">
       Coding exercise
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id13">
         Submit your feedback
        </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id14">
         Submit your feedback
        </a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id15">
       Discussion point
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id16">
         Submit your feedback
        </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-8-outro-ignition">
         Video 8: Outro - Ignition
        </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id17">
         Submit your feedback
        </a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#summary">
   Summary
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-9-final-thoughts">
     Video 9: Final Thoughts
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id18">
     Submit your feedback
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-10-final-thoughts">
     Video 10: Final Thoughts
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id19">
     Submit your feedback
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-bonus-section">
   Coding Bonus Section
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#bonus-coding-exersice-1-train-a-first-order-network">
     Bonus coding exersice 1: Train a first-order network
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#activity-1-building-a-network-for-a-blindsight-situation">
       Activity 1: Building a network for a blindsight situation
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#testing-under-3-blindsight-conditions">
       Testing under 3 blindsight conditions
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id20">
         Submit your feedback
        </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#bonus-coding-section-2-plot-surfaces-for-content-awareness-inferences">
     Bonus coding section 2: Plot surfaces for content / awareness inferences
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id21">
       Discussion point
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id22">
         Submit your feedback
        </a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#discussion-bonus-section">
   Discussion Bonus Section
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-11-consciousness-bonus-content">
     Video 11: Consciousness Bonus Content
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id23">
     Submit your feedback
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#discussion-activity-is-it-actually-conscious">
     Discussion activity: Is it actually conscious?
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id24">
       Submit your feedback
      </a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
<article class="bd-article" role="main">
<p><a href="https://colab.research.google.com/github/neuromatch/NeuroAI_Course/blob/main/tutorials/W2D5_Mysteries/student/W2D5_Tutorial1.ipynb" target="_blank"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg"/></a>   <a href="https://kaggle.com/kernels/welcome?src=https://raw.githubusercontent.com/neuromatch/NeuroAI_Course/main/tutorials/W2D5_Mysteries/student/W2D5_Tutorial1.ipynb" target="_blank"><img alt="Open in Kaggle" src="https://kaggle.com/static/images/open-in-kaggle.svg"/></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="tutorial-1-consciousness">
<h1>Tutorial 1: Consciousness<a class="headerlink" href="#tutorial-1-consciousness" title="Permalink to this heading">#</a></h1>
<p><strong>Week 2, Day 5: Mysteries</strong></p>
<p><strong>By Neuromatch Academy</strong></p>
<p><strong>Content creators:</strong> Steve Fleming, Guillaume Dumas, Samuele Bolotta, Juan David Vargas, Hakwan Lau, Anil Seth, Megan Peters</p>
<p><strong>Content reviewers:</strong> Samuele Bolotta, Lily Chamakura, RyeongKyung Yoon, Yizhou Chen, Ruiyi Zhang, Patrick Mineault</p>
<p><strong>Production editors:</strong> Konstantine Tsafatinos, Ella Batty, Spiros Chavlis, Samuele Bolotta, Hlib Solodzhuk, Patrick Mineault</p>
</section>
<hr class="docutils"/>
<section class="tex2jax_ignore mathjax_ignore" id="tutorial-objectives">
<h1>Tutorial Objectives<a class="headerlink" href="#tutorial-objectives" title="Permalink to this heading">#</a></h1>
<p><em>Estimated timing of tutorial: 120 minutes</em></p>
<p>By the end of this tutorial, participants will be able to:</p>
<ol class="arabic simple">
<li><p>Understand and distinguish various aspects of consciousness including the hard problem of consciousness, the difference between phenomenal consciousness and access consciousness, as well as the distinctions between consciousness and sentience or intelligence.</p></li>
<li><p>Explore core frameworks for analyzing consciousness, including diagnostic criteria, and will compare objective probabilities with subjective credences.</p></li>
<li><p>Explore reductionist theories of consciousness, such as Global Workspace Theory (GWT), theories of metacognition, and Higher-Order Thought (HOT) theories.</p></li>
</ol>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "395ab2935c1c497d8b2753b4bdbcd3d4"}</script></div>
</div>
</section>
<hr class="docutils"/>
<section class="tex2jax_ignore mathjax_ignore" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h1>
<section id="install-and-import-feedback-gadget">
<h2>Install and import feedback gadget<a class="headerlink" href="#install-and-import-feedback-gadget" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Install and import feedback gadget</span>

<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>vibecheck<span class="w"> </span>numpy<span class="w"> </span>matplotlib<span class="w"> </span>Pillow<span class="w"> </span>torch<span class="w"> </span>torchvision<span class="w"> </span>transformers<span class="w"> </span>ipywidgets<span class="w"> </span>gradio<span class="w"> </span>trdg<span class="w"> </span>scikit-learn<span class="w"> </span>networkx<span class="w"> </span>pickleshare<span class="w"> </span>seaborn<span class="w"> </span>tabulate<span class="w"> </span>--quiet

<span class="kn">from</span><span class="w"> </span><span class="nn">vibecheck</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatatopsContentReviewContainer</span>
<span class="k">def</span><span class="w"> </span><span class="nf">content_review</span><span class="p">(</span><span class="n">notebook_section</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">DatatopsContentReviewContainer</span><span class="p">(</span>
        <span class="s2">""</span><span class="p">,</span>  <span class="c1"># No text prompt</span>
        <span class="n">notebook_section</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"https://pmyvdlilci.execute-api.us-east-1.amazonaws.com/klab"</span><span class="p">,</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"neuromatch_neuroai"</span><span class="p">,</span>
            <span class="s2">"user_key"</span><span class="p">:</span> <span class="s2">"wb2cxze8"</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>

<span class="n">feedback_prefix</span> <span class="o">=</span> <span class="s2">"W2D5_T1"</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class="-Color -Color-Yellow">WARNING: typer 0.15.2 does not provide the extra 'all'</span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="import-dependencies">
<h2>Import dependencies<a class="headerlink" href="#import-dependencies" title="Permalink to this heading">#</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
</section>
<section id="figure-settings">
<h2>Figure settings<a class="headerlink" href="#figure-settings" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Figure settings</span>
<span class="c1"># @markdown</span>

<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">'matplotlib.font_manager'</span><span class="p">)</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = 'retina' # perfrom high definition rendering for images and plots
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/NeuromatchAcademy/course-content/main/nma.mplstyle"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="helper-functions">
<h2>Helper functions<a class="headerlink" href="#helper-functions" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Helper functions</span>

<span class="n">mse_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BCELoss</span><span class="p">(</span><span class="n">size_average</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">lam</span> <span class="o">=</span> <span class="mf">1e-4</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">torch.autograd</span><span class="w"> </span><span class="kn">import</span> <span class="n">Variable</span>

<span class="k">def</span><span class="w"> </span><span class="nf">CAE_loss</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">recons_x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Compute the Contractive AutoEncoder Loss</span>

<span class="sd">    Evalutes the CAE loss, which is composed as the summation of a Mean</span>
<span class="sd">    Squared Error and the weighted l2-norm of the Jacobian of the hidden</span>
<span class="sd">    units with respect to the inputs.</span>


<span class="sd">    See reference below for an in-depth discussion:</span>
<span class="sd">      #1: http://wiseodd.github.io/techblog/2016/12/05/contractive-autoencoder</span>

<span class="sd">    Args:</span>
<span class="sd">        `W` (FloatTensor): (N_hidden x N), where N_hidden and N are the</span>
<span class="sd">          dimensions of the hidden units and input respectively.</span>
<span class="sd">        `x` (Variable): the input to the network, with dims (N_batch x N)</span>
<span class="sd">        recons_x (Variable): the reconstruction of the input, with dims</span>
<span class="sd">          N_batch x N.</span>
<span class="sd">        `h` (Variable): the hidden units of the network, with dims</span>
<span class="sd">          batch_size x N_hidden</span>
<span class="sd">        `lam` (float): the weight given to the jacobian regulariser term</span>

<span class="sd">    Returns:</span>
<span class="sd">        Variable: the (scalar) CAE loss</span>
<span class="sd">    """</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">mse_loss</span><span class="p">(</span><span class="n">recons_x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="c1"># Since: W is shape of N_hidden x N. So, we do not need to transpose it as</span>
    <span class="c1"># opposed to #1</span>
    <span class="n">dh</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="c1"># Hadamard product produces size N_batch x N_hidden</span>
    <span class="c1"># Sum through the input dimension to improve efficiency, as suggested in #1</span>
    <span class="n">w_sum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Variable</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># unsqueeze to avoid issues with torch.mv</span>
    <span class="n">w_sum</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># shape N_hidden x 1</span>
    <span class="n">contractive_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">dh</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">w_sum</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mse</span> <span class="o">+</span> <span class="n">contractive_loss</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FirstOrderNetwork</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hidden_units</span><span class="p">,</span> <span class="n">data_factor</span><span class="p">,</span> <span class="n">use_gelu</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initializes the FirstOrderNetwork with specific configurations.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - hidden_units (int): The number of units in the hidden layer.</span>
<span class="sd">        - data_factor (int): Factor to scale the amount of data processed.</span>
<span class="sd">                             A factor of 1 indicates the default data amount,</span>
<span class="sd">                             while 10 indicates 10 times the default amount.</span>
<span class="sd">        - use_gelu (bool): Flag to use GELU (True) or ReLU (False) as the activation function.</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FirstOrderNetwork</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Define the encoder, hidden, and decoder layers with specified units</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">hidden_units</span><span class="p">,</span> <span class="n">bias</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Encoder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_units</span><span class="p">,</span> <span class="n">hidden_units</span><span class="p">,</span> <span class="n">bias</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Hidden</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_units</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">bias</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Decoder</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmoid</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">()</span>


        <span class="c1"># Dropout layer to prevent overfitting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="c1"># Set the data factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_factor</span> <span class="o">=</span> <span class="n">data_factor</span>

        <span class="c1"># Other activation functions for various purposes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Softmax</span><span class="p">()</span>

        <span class="c1"># Initialize network weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_weights</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">initialize_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Initializes weights of the encoder, hidden, and decoder layers uniformly."""</span>
        <span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
      <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">))))</span>
      <span class="k">return</span> <span class="n">h1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
      <span class="c1">#h2 = self.relu(self.hidden(z))</span>
      <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">h2</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">      </span><span class="sd">"""</span>
<span class="sd">      Defines the forward pass through the network.</span>

<span class="sd">      Parameters:</span>
<span class="sd">      - x (Tensor): The input tensor to the network.</span>

<span class="sd">      Returns:</span>
<span class="sd">      - Tensor: The output of the network after passing through the layers and activations.</span>
<span class="sd">      """</span>
      <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">h1</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">h1</span> <span class="p">,</span> <span class="n">h2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">initialize_global</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">Input_Size_1</span><span class="p">,</span> <span class="n">Hidden_Size_1</span><span class="p">,</span> <span class="n">Output_Size_1</span><span class="p">,</span> <span class="n">Input_Size_2</span>
    <span class="k">global</span> <span class="n">num_units</span><span class="p">,</span> <span class="n">patterns_number</span>
    <span class="k">global</span> <span class="n">learning_rate_2</span><span class="p">,</span> <span class="n">momentum</span><span class="p">,</span> <span class="n">temperature</span> <span class="p">,</span> <span class="n">Threshold</span>
    <span class="k">global</span> <span class="n">First_set</span><span class="p">,</span> <span class="n">Second_set</span><span class="p">,</span> <span class="n">Third_set</span>
    <span class="k">global</span> <span class="n">First_set_targets</span><span class="p">,</span> <span class="n">Second_set_targets</span><span class="p">,</span> <span class="n">Third_set_targets</span>
    <span class="k">global</span> <span class="n">epoch_list</span><span class="p">,</span> <span class="n">epoch_1_order</span><span class="p">,</span> <span class="n">epoch_2_order</span><span class="p">,</span> <span class="n">patterns_matrix1</span>
    <span class="k">global</span> <span class="n">testing_graph_names</span>

    <span class="k">global</span> <span class="n">optimizer</span> <span class="p">,</span><span class="n">n_epochs</span> <span class="p">,</span> <span class="n">learning_rate_1</span>
    <span class="n">learning_rate_1</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s2">"ADAMAX"</span>

    <span class="c1"># Network sizes</span>
    <span class="n">Input_Size_1</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">Hidden_Size_1</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">Output_Size_1</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">Input_Size_2</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="c1"># Patterns</span>
    <span class="n">num_units</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">patterns_number</span> <span class="o">=</span> <span class="mi">200</span>

    <span class="c1"># Pre-training and hyperparameters</span>
    <span class="n">learning_rate_2</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">momentum</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">Threshold</span><span class="o">=</span><span class="mf">0.5</span>

    <span class="c1"># Testing</span>
    <span class="n">First_set</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Second_set</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Third_set</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">First_set_targets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Second_set_targets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Third_set_targets</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Graphic of pretraining</span>
    <span class="n">epoch_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">epoch_1_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">)</span>
    <span class="n">epoch_2_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">)</span>
    <span class="n">patterns_matrix1</span> <span class="o">=</span>  <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_epochs</span><span class="p">,</span> <span class="n">patterns_number</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>  <span class="c1"># Initialize patterns_matrix as a PyTorch tensor on the GPU</span>



<span class="k">def</span><span class="w"> </span><span class="nf">compute_metrics</span><span class="p">(</span><span class="n">TP</span><span class="p">,</span> <span class="n">TN</span><span class="p">,</span> <span class="n">FP</span><span class="p">,</span> <span class="n">FN</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Compute precision, recall, F1 score, and accuracy."""</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">TP</span> <span class="o">+</span> <span class="n">FP</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">TP</span> <span class="o">+</span> <span class="n">FP</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">TP</span> <span class="o">+</span> <span class="n">FN</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">TP</span> <span class="o">+</span> <span class="n">FN</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">f1_score</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">precision</span> <span class="o">*</span> <span class="n">recall</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">TP</span> <span class="o">+</span> <span class="n">TN</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">TP</span> <span class="o">+</span> <span class="n">TN</span> <span class="o">+</span> <span class="n">FP</span> <span class="o">+</span> <span class="n">FN</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">TP</span> <span class="o">+</span> <span class="n">TN</span> <span class="o">+</span> <span class="n">FP</span> <span class="o">+</span> <span class="n">FN</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">accuracy</span>

<span class="c1"># define the architecture, optimizers, loss functions, and schedulers for pre training</span>
<span class="k">def</span><span class="w"> </span><span class="nf">prepare_pre_training</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span><span class="n">factor</span><span class="p">,</span><span class="n">gelu</span><span class="p">,</span><span class="n">stepsize</span><span class="p">,</span> <span class="n">gam</span><span class="p">):</span>

  <span class="n">first_order_network</span> <span class="o">=</span> <span class="n">FirstOrderNetwork</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">gelu</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
  <span class="n">second_order_network</span> <span class="o">=</span> <span class="n">SecondOrderNetwork</span><span class="p">(</span><span class="n">gelu</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

  <span class="n">criterion_1</span> <span class="o">=</span> <span class="n">CAE_loss</span>
  <span class="n">criterion_2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BCELoss</span><span class="p">(</span><span class="n">size_average</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>


  <span class="k">if</span> <span class="n">optimizer</span> <span class="o">==</span> <span class="s2">"ADAM"</span><span class="p">:</span>
    <span class="n">optimizer_1</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">first_order_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_1</span><span class="p">)</span>
    <span class="n">optimizer_2</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">second_order_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_2</span><span class="p">)</span>

  <span class="k">elif</span> <span class="n">optimizer</span> <span class="o">==</span> <span class="s2">"SGD"</span><span class="p">:</span>
    <span class="n">optimizer_1</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">first_order_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_1</span><span class="p">)</span>
    <span class="n">optimizer_2</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">second_order_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_2</span><span class="p">)</span>

  <span class="k">elif</span> <span class="n">optimizer</span> <span class="o">==</span> <span class="s2">"SWATS"</span><span class="p">:</span>
    <span class="n">optimizer_1</span> <span class="o">=</span> <span class="n">optim2</span><span class="o">.</span><span class="n">SWATS</span><span class="p">(</span><span class="n">first_order_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_1</span><span class="p">)</span>
    <span class="n">optimizer_2</span> <span class="o">=</span> <span class="n">optim2</span><span class="o">.</span><span class="n">SWATS</span><span class="p">(</span><span class="n">second_order_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_2</span><span class="p">)</span>

  <span class="k">elif</span> <span class="n">optimizer</span> <span class="o">==</span> <span class="s2">"ADAMW"</span><span class="p">:</span>
    <span class="n">optimizer_1</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">AdamW</span><span class="p">(</span><span class="n">first_order_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_1</span><span class="p">)</span>
    <span class="n">optimizer_2</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">AdamW</span><span class="p">(</span><span class="n">second_order_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_2</span><span class="p">)</span>

  <span class="k">elif</span> <span class="n">optimizer</span> <span class="o">==</span> <span class="s2">"RMS"</span><span class="p">:</span>
    <span class="n">optimizer_1</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">RMSprop</span><span class="p">(</span><span class="n">first_order_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_1</span><span class="p">)</span>
    <span class="n">optimizer_2</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">RMSprop</span><span class="p">(</span><span class="n">second_order_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_2</span><span class="p">)</span>

  <span class="k">elif</span> <span class="n">optimizer</span> <span class="o">==</span> <span class="s2">"ADAMAX"</span><span class="p">:</span>
    <span class="n">optimizer_1</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adamax</span><span class="p">(</span><span class="n">first_order_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_1</span><span class="p">)</span>
    <span class="n">optimizer_2</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adamax</span><span class="p">(</span><span class="n">second_order_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_2</span><span class="p">)</span>

  <span class="c1"># Learning rate schedulers</span>
  <span class="n">scheduler_1</span> <span class="o">=</span> <span class="n">StepLR</span><span class="p">(</span><span class="n">optimizer_1</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">stepsize</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gam</span><span class="p">)</span>
  <span class="n">scheduler_2</span> <span class="o">=</span> <span class="n">StepLR</span><span class="p">(</span><span class="n">optimizer_2</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">stepsize</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gam</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">first_order_network</span><span class="p">,</span> <span class="n">second_order_network</span><span class="p">,</span> <span class="n">criterion_1</span> <span class="p">,</span> <span class="n">criterion_2</span><span class="p">,</span> <span class="n">optimizer_1</span><span class="p">,</span> <span class="n">optimizer_2</span><span class="p">,</span> <span class="n">scheduler_1</span><span class="p">,</span> <span class="n">scheduler_2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">title</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="c1"># Enable XKCD plot styling</span>
    <span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">():</span>
        <span class="c1"># Create a figure and an axes.</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

        <span class="c1"># Create a rectangle patch with specified dimensions and styles</span>
        <span class="n">rectangle</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rectangle</span><span class="p">)</span>

        <span class="c1"># Place text inside the rectangle, centered</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'white'</span><span class="p">)</span>

        <span class="c1"># Set plot limits</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Disable axis display</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'off'</span><span class="p">)</span>

        <span class="c1"># Display the plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Close the figure to free up memory</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="c1"># Function to configure the training environment and load the models</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_test_patterns</span><span class="p">(</span><span class="n">factor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Configures the training environment by saving the state of the given models and loading them back.</span>
<span class="sd">    Initializes testing patterns for evaluation.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - Tuple of testing patterns, number of samples in the testing patterns</span>
<span class="sd">    """</span>
    <span class="c1"># Generating testing patterns for three different sets</span>
    <span class="n">first_set</span><span class="p">,</span> <span class="n">first_set_targets</span> <span class="o">=</span> <span class="n">create_patterns</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>
    <span class="n">second_set</span><span class="p">,</span> <span class="n">second_set_targets</span> <span class="o">=</span> <span class="n">create_patterns</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>
    <span class="n">third_set</span><span class="p">,</span> <span class="n">third_set_targets</span> <span class="o">=</span> <span class="n">create_patterns</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>

    <span class="c1"># Aggregate testing patterns and their targets for ease of access</span>
    <span class="n">testing_patterns</span> <span class="o">=</span> <span class="p">[[</span><span class="n">first_set</span><span class="p">,</span> <span class="n">first_set_targets</span><span class="p">],</span> <span class="p">[</span><span class="n">second_set</span><span class="p">,</span> <span class="n">second_set_targets</span><span class="p">],</span> <span class="p">[</span><span class="n">third_set</span><span class="p">,</span> <span class="n">third_set_targets</span><span class="p">]]</span>

    <span class="c1"># Determine the number of samples from the first set (assumed consistent across all sets)</span>
    <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">testing_patterns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">testing_patterns</span><span class="p">,</span> <span class="n">n_samples</span>

<span class="c1"># Function to test the model using the configured testing patterns</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_input_output</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">output_data</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># Plot input data</span>
    <span class="n">im1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">input_data</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'viridis'</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Input'</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Plot output data</span>
    <span class="n">im2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">output_data</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'viridis'</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Output'</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Testing Pattern </span><span class="si">{</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Function to test the model using the configured testing patterns</span>
<span class="c1"># Function to test the model using the configured testing patterns</span>
<span class="k">def</span><span class="w"> </span><span class="nf">testing</span><span class="p">(</span><span class="n">testing_patterns</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">loaded_model</span><span class="p">,</span> <span class="n">loaded_model_2</span><span class="p">,</span><span class="n">factor</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_chance_level</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
      <span class="n">chance_level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="k">return</span> <span class="n">chance_level</span>

    <span class="n">results_for_plotting</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_values_output_first_order</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_indices_output_first_order</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_values_patterns_tensor</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_indices_patterns_tensor</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">f1_scores_wager</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">mse_losses_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mse_losses_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">discrimination_performances</span> <span class="o">=</span> <span class="p">[]</span>



    <span class="c1"># Iterate through each set of testing patterns and targets</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">testing_patterns</span><span class="p">)):</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>  <span class="c1"># Ensure no gradients are computed during testing</span>

            <span class="c1">#For low vision the stimulus threshold was set to 0.3 as can seen in the generate_patters function</span>
            <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">threshold</span><span class="o">=</span><span class="mf">0.15</span>

            <span class="c1"># Obtain output from the first order model</span>
            <span class="n">input_data</span> <span class="o">=</span> <span class="n">testing_patterns</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">hidden_representation</span><span class="p">,</span>  <span class="n">output_first_order</span> <span class="o">=</span> <span class="n">loaded_model</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
            <span class="n">output_second_order</span> <span class="o">=</span> <span class="n">loaded_model_2</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">output_first_order</span><span class="p">)</span>

            <span class="n">delta</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">factor</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">"driscriminator"</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">((</span><span class="n">output_first_order</span><span class="p">[</span><span class="n">delta</span><span class="p">:]</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">input_data</span><span class="p">[</span><span class="n">delta</span><span class="p">:]</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
            <span class="n">discrimination_performance</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">output_first_order</span><span class="p">[</span><span class="n">delta</span><span class="p">:]</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">input_data</span><span class="p">[</span><span class="n">delta</span><span class="p">:]</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">discrimination_performances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">discrimination_performance</span><span class="p">)</span>


            <span class="n">chance_level</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span> <span class="n">generate_chance_level</span><span class="p">((</span><span class="mi">200</span><span class="o">*</span><span class="n">factor</span><span class="p">,</span><span class="mi">100</span><span class="p">)))</span>
            <span class="n">discrimination_random</span><span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">chance_level</span><span class="p">[</span><span class="n">delta</span><span class="p">:]</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">input_data</span><span class="p">[</span><span class="n">delta</span><span class="p">:]</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"chance level"</span> <span class="p">,</span> <span class="n">discrimination_random</span><span class="p">)</span>



            <span class="c1">#count all patterns in the dataset</span>
            <span class="n">wagers</span> <span class="o">=</span> <span class="n">output_second_order</span><span class="p">[</span><span class="n">delta</span><span class="p">:]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>

            <span class="n">_</span><span class="p">,</span> <span class="n">targets_2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">testing_patterns</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">targets_2</span> <span class="o">=</span> <span class="n">targets_2</span><span class="p">[</span><span class="n">delta</span><span class="p">:]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>

            <span class="c1"># Convert targets to binary classification for wagering scenario</span>
            <span class="n">targets_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">targets_2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">int</span><span class="p">()</span>

            <span class="c1"># Convert tensors to NumPy arrays for metric calculations</span>
            <span class="n">predicted_np</span> <span class="o">=</span> <span class="n">wagers</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">targets_2_np</span> <span class="o">=</span> <span class="n">targets_2</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

            <span class="c1">#print("number of targets," , len(targets_2_np))</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">predicted_np</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">targets_2_np</span><span class="p">)</span>

            <span class="c1"># Calculate True Positives, True Negatives, False Positives, and False Negatives</span>
            <span class="n">TP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">predicted_np</span> <span class="o">&gt;</span>  <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">targets_2_np</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">))</span>
            <span class="n">TN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">predicted_np</span> <span class="o">&lt;</span>  <span class="n">threshold</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">targets_2_np</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">))</span>
            <span class="n">FP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">predicted_np</span> <span class="o">&gt;</span>  <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">targets_2_np</span> <span class="o">&lt;</span>  <span class="n">threshold</span><span class="p">))</span>
            <span class="n">FN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">predicted_np</span> <span class="o">&lt;</span>  <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">targets_2_np</span> <span class="o">&gt;</span>  <span class="n">threshold</span><span class="p">))</span>

            <span class="c1"># Compute precision, recall, F1 score, and accuracy for both high and low wager scenarios</span>
            <span class="n">precision_h</span><span class="p">,</span> <span class="n">recall_h</span><span class="p">,</span> <span class="n">f1_score_h</span><span class="p">,</span> <span class="n">accuracy_h</span> <span class="o">=</span> <span class="n">compute_metrics</span><span class="p">(</span><span class="n">TP</span><span class="p">,</span> <span class="n">TN</span><span class="p">,</span> <span class="n">FP</span><span class="p">,</span> <span class="n">FN</span><span class="p">)</span>

            <span class="n">f1_scores_wager</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f1_score_h</span><span class="p">)</span>

            <span class="c1"># Collect results for plotting</span>
            <span class="n">results_for_plotting</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">"counts"</span><span class="p">:</span> <span class="p">[[</span><span class="n">TP</span><span class="p">,</span> <span class="n">FP</span><span class="p">,</span> <span class="n">TP</span> <span class="o">+</span> <span class="n">FP</span><span class="p">]],</span>
                <span class="s2">"metrics"</span><span class="p">:</span> <span class="p">[[</span><span class="n">precision_h</span><span class="p">,</span> <span class="n">recall_h</span><span class="p">,</span> <span class="n">f1_score_h</span><span class="p">,</span> <span class="n">accuracy_h</span><span class="p">]],</span>
                <span class="s2">"title_results"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Results Table - Set </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                <span class="s2">"title_metrics"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Metrics Table - Set </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">})</span>

            <span class="c1"># Plot input and output of the first-order network</span>
            <span class="n">plot_input_output</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">output_first_order</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

            <span class="n">max_vals_out</span><span class="p">,</span> <span class="n">max_inds_out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">output_first_order</span><span class="p">[</span><span class="mi">100</span><span class="p">:],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">max_inds_out</span><span class="p">[</span><span class="n">max_vals_out</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">max_values_output_first_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_vals_out</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">max_indices_output_first_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_inds_out</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="n">max_vals_pat</span><span class="p">,</span> <span class="n">max_inds_pat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">input_data</span><span class="p">[</span><span class="mi">100</span><span class="p">:],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">max_inds_pat</span><span class="p">[</span><span class="n">max_vals_pat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">max_values_patterns_tensor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_vals_pat</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">max_indices_patterns_tensor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_inds_pat</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

            <span class="c1"># Scatter plot of indices: patterns_tensor vs. output_first_order</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">max_indices_patterns_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">max_indices_output_first_order</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Stimuli location: Condition </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> - First Order Input vs. First Order Output'</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'First Order Input Indices'</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'First Order Output Indices'</span><span class="p">)</span>

            <span class="c1"># Add quadratic fit to scatter plot</span>
            <span class="n">x_indices</span> <span class="o">=</span> <span class="n">max_indices_patterns_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">y_indices</span> <span class="o">=</span> <span class="n">max_indices_output_first_order</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">y_pred_indices</span> <span class="o">=</span> <span class="n">perform_quadratic_regression</span><span class="p">(</span><span class="n">x_indices</span><span class="p">,</span> <span class="n">y_indices</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_indices</span><span class="p">,</span> <span class="n">y_pred_indices</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'skyblue'</span><span class="p">)</span>


            <span class="c1"># Calculate MSE loss for indices</span>
            <span class="n">mse_loss_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_indices</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_indices</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">mse_losses_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mse_loss_indices</span><span class="p">)</span>

            <span class="c1"># Scatter plot of values: patterns_tensor vs. output_first_order</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">max_values_patterns_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">max_values_output_first_order</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Stimuli Values: Condition </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> - First Order Input vs. First Order Output'</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'First Order Input Values'</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'First Order Output Values'</span><span class="p">)</span>

            <span class="c1"># Add quadratic fit to scatter plot</span>
            <span class="n">x_values</span> <span class="o">=</span> <span class="n">max_values_patterns_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">y_values</span> <span class="o">=</span> <span class="n">max_values_output_first_order</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">y_pred_values</span> <span class="o">=</span> <span class="n">perform_quadratic_regression</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_pred_values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'skyblue'</span><span class="p">)</span>

            <span class="c1"># Calculate MSE loss for values</span>
            <span class="n">mse_loss_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_values</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">mse_losses_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mse_loss_values</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">f1_scores_wager</span><span class="p">,</span> <span class="n">mse_losses_indices</span> <span class="p">,</span> <span class="n">mse_losses_values</span><span class="p">,</span> <span class="n">discrimination_performances</span><span class="p">,</span> <span class="n">results_for_plotting</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_patterns</span><span class="p">(</span><span class="n">patterns_number</span><span class="p">,</span> <span class="n">num_units</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">condition</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Generates patterns and targets for training the networks</span>

<span class="sd">    # patterns_number: Number of patterns to generate</span>
<span class="sd">    # num_units: Number of units in each pattern</span>
<span class="sd">    # pattern: 0: superthreshold, 1: subthreshold, 2: low vision</span>
<span class="sd">    # Returns lists of patterns, stimulus present/absent indicators, and second order targets</span>
<span class="sd">    """</span>

    <span class="n">patterns_number</span><span class="o">=</span> <span class="n">patterns_number</span><span class="o">*</span><span class="n">factor</span>

    <span class="n">patterns</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Store generated patterns</span>
    <span class="n">stim_present</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Indicators for when a stimulus is present in the pattern</span>
    <span class="n">stim_absent</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Indicators for when no stimulus is present</span>
    <span class="n">order_2_pr</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Second order network targets based on the presence or absence of stimulus</span>

    <span class="k">if</span> <span class="n">condition</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">random_limit</span><span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">condition</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">random_limit</span><span class="o">=</span> <span class="mf">0.02</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="mf">0.0012</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">condition</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">random_limit</span><span class="o">=</span> <span class="mf">0.02</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="mf">0.0012</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="mf">0.3</span>

    <span class="c1"># Generate patterns, half noise and half potential stimuli</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">patterns_number</span><span class="p">):</span>

        <span class="c1"># First half: Noise patterns</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">patterns_number</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>

            <span class="n">pattern</span> <span class="o">=</span> <span class="n">multiplier</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">random_limit</span><span class="p">,</span> <span class="n">num_units</span><span class="p">)</span> <span class="o">+</span> <span class="n">baseline</span> <span class="c1"># Generate a noise pattern</span>
            <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
            <span class="n">stim_present</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_units</span><span class="p">))</span>  <span class="c1"># Stimulus absent</span>
            <span class="n">order_2_pr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>  <span class="c1"># No stimulus, low wager</span>

        <span class="c1"># Second half: Stimulus patterns</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stimulus_number</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_units</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Choose a unit for potential stimulus</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">random_limit</span><span class="p">,</span> <span class="n">num_units</span><span class="p">)</span> <span class="o">+</span> <span class="n">baseline</span>
            <span class="n">pattern</span><span class="p">[</span><span class="n">stimulus_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">multiplier</span>   <span class="c1"># Set stimulus intensity</span>

            <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
            <span class="n">present</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_units</span><span class="p">)</span>
            <span class="c1"># Determine if stimulus is above discrimination threshold</span>
            <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="n">stimulus_number</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">multiplier</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">order_2_pr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">1.0</span> <span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>  <span class="c1"># Stimulus detected, high wager</span>
                <span class="n">present</span><span class="p">[</span><span class="n">stimulus_number</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">order_2_pr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.0</span> <span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>  <span class="c1"># Stimulus not detected, low wager</span>
                <span class="n">present</span><span class="p">[</span><span class="n">stimulus_number</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="n">stim_present</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">present</span><span class="p">)</span>


    <span class="n">patterns_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">patterns</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">stim_present_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">stim_present</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">stim_absent_tensor</span><span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">stim_absent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">order_2_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">order_2_pr</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">patterns_tensor</span><span class="p">,</span> <span class="n">stim_present_tensor</span><span class="p">,</span> <span class="n">stim_absent_tensor</span><span class="p">,</span> <span class="n">order_2_tensor</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_patterns</span><span class="p">(</span><span class="n">stimulus</span><span class="p">,</span><span class="n">factor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Generates neural network input patterns based on specified stimulus conditions.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - stimulus (int): Determines the type of patterns to generate.</span>
<span class="sd">                      Acceptable values:</span>
<span class="sd">                      - 0: Suprathreshold stimulus</span>
<span class="sd">                      - 1: Subthreshold stimulus</span>
<span class="sd">                      - 2: Low vision condition</span>

<span class="sd">    Returns:</span>
<span class="sd">    - torch.Tensor: Tensor of generated patterns.</span>
<span class="sd">    - torch.Tensor: Tensor of target values corresponding to the generated patterns.</span>
<span class="sd">    """</span>

    <span class="c1"># Generate initial patterns and target tensors for base condition.</span>

    <span class="n">patterns_tensor</span><span class="p">,</span> <span class="n">stim_present_tensor</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generate_patterns</span><span class="p">(</span><span class="n">patterns_number</span><span class="p">,</span> <span class="n">num_units</span> <span class="p">,</span><span class="n">factor</span><span class="p">,</span> <span class="n">stimulus</span><span class="p">)</span>
    <span class="c1"># Convert pattern tensors for processing on specified device (CPU/GPU).</span>
    <span class="n">patterns</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">patterns_tensor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">stim_present_tensor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">targets</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="plotting-functions">
<h2>Plotting functions<a class="headerlink" href="#plotting-functions" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Plotting functions</span>
<span class="c1"># @markdown</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_testing</span><span class="p">(</span><span class="n">results_seed</span><span class="p">,</span> <span class="n">discrimination_seed</span><span class="p">,</span> <span class="n">seeds</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">results_seed</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">discrimination_seed</span><span class="p">)</span>

    <span class="n">Testing_graph_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Suprathreshold stimulus"</span><span class="p">,</span> <span class="s2">"Subthreshold stimulus"</span><span class="p">,</span> <span class="s2">"Low Vision"</span><span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results_seed</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># Adjusted for added header space</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'off'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'tight'</span><span class="p">)</span>

    <span class="c1"># Define column labels</span>
    <span class="n">col_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Scenario"</span><span class="p">,</span> <span class="s2">"F1 SCORE</span><span class="se">\n</span><span class="s2">(2nd order network)"</span><span class="p">,</span> <span class="s2">"RECALL</span><span class="se">\n</span><span class="s2">(2nd order network)"</span><span class="p">,</span> <span class="s2">"PRECISION</span><span class="se">\n</span><span class="s2">(2nd order network)"</span><span class="p">,</span> <span class="s2">"Discrimination Performance</span><span class="se">\n</span><span class="s2">(1st order network)"</span><span class="p">,</span> <span class="s2">"ACCURACY</span><span class="se">\n</span><span class="s2">(2nd order network)"</span><span class="p">]</span>

    <span class="c1"># Initialize list to hold all rows of data including headers</span>
    <span class="n">full_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Calculate averages and standard deviations</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results_seed</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">metrics_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">"metrics"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results_seed</span><span class="p">]</span>  <span class="c1"># Collect metrics for each seed</span>
        <span class="n">discrimination_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">discrimination_seed</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">seeds</span><span class="p">)]</span>

        <span class="c1"># Calculate averages and standard deviations for metrics</span>
        <span class="n">avg_metrics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">metrics_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">std_metrics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">metrics_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># Calculate average and standard deviation for discrimination performance</span>
        <span class="n">avg_discrimination</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">discrimination_list</span><span class="p">)</span>
        <span class="n">std_discrimination</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">discrimination_list</span><span class="p">)</span>

        <span class="c1"># Format the row with averages and standard deviations</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Testing_graph_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">avg_metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">std_metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>  <span class="c1"># F1 SCORE</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">avg_metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">std_metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>  <span class="c1"># RECALL</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">avg_metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">std_metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>  <span class="c1"># PRECISION</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">avg_discrimination</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">std_discrimination</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>  <span class="c1"># Discrimination Performance</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">avg_metrics</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">std_metrics</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span>  <span class="c1"># ACCURACY</span>
        <span class="p">]</span>
        <span class="n">full_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

    <span class="c1"># Extract metric values for color scaling (excluding the first and last columns which are text)</span>
    <span class="n">metric_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">" ± "</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">full_data</span><span class="p">])</span>  <span class="c1"># Convert to float for color scaling</span>
    <span class="n">max_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">metric_values</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">metric_values</span> <span class="o">/</span> <span class="n">max_value</span>  <span class="c1"># Normalize for color mapping</span>

    <span class="c1"># Prepare colors for all cells, defaulting to white for non-metric cells</span>
    <span class="n">cell_colors</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">"white"</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_labels</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">full_data</span><span class="p">))]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
        <span class="n">cell_colors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlGn</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cell_colors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlGn</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cell_colors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlGn</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">cell_colors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlGn</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># Adding color for accuracy</span>

    <span class="c1"># Adding color for discrimination performance</span>
    <span class="n">discrimination_colors</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dp_color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">discrimination_colors</span><span class="p">):</span>
        <span class="n">cell_colors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlGn</span><span class="p">(</span><span class="n">dp_color</span><span class="p">)</span>

    <span class="c1"># Create the main table with cell colors</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">cellText</span><span class="o">=</span><span class="n">full_data</span><span class="p">,</span> <span class="n">colLabels</span><span class="o">=</span><span class="n">col_labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">cellLoc</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">cellColours</span><span class="o">=</span><span class="n">cell_colors</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">auto_set_font_size</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

    <span class="c1"># Set the height of the header row to be double that of the other rows</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">col_label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">col_labels</span><span class="p">):</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">table</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">)]</span>
        <span class="n">cell</span><span class="o">.</span><span class="n">set_height</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Add chance level table</span>
    <span class="n">chance_level_data</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">"Chance Level</span><span class="se">\n</span><span class="s2">Discrimination(1st)"</span><span class="p">,</span> <span class="s2">"Chance Level</span><span class="se">\n</span><span class="s2">Accuracy(2nd)"</span><span class="p">],</span>
                         <span class="p">[</span><span class="s2">"0.010"</span><span class="p">,</span> <span class="s2">"0.50"</span><span class="p">]]</span>

    <span class="n">chance_table</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">cellText</span><span class="o">=</span><span class="n">chance_level_data</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">cellLoc</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
    <span class="n">chance_table</span><span class="o">.</span><span class="n">auto_set_font_size</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">chance_table</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">chance_table</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>

    <span class="c1"># Set the height of the header row to be double that of the other rows in the chance level table</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chance_level_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">chance_table</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">)]</span>
        <span class="n">cell</span><span class="o">.</span><span class="n">set_height</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_signal_max_and_indicator</span><span class="p">(</span><span class="n">patterns_tensor</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s2">"Training Signals"</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Plots the maximum values of signal units and a binary indicator for max values greater than 0.5.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - patterns_tensor: A tensor containing signals, where each signal is expected to have multiple units.</span>
<span class="sd">    """</span>
    <span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">():</span>

        <span class="c1"># Calculate the maximum value of units for each signal within the patterns tensor</span>
        <span class="n">max_values_of_units</span> <span class="o">=</span> <span class="n">patterns_tensor</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>  <span class="c1"># Ensure it's on CPU and in NumPy format for plotting</span>

        <span class="c1"># Determine the binary indicators based on the max value being greater than 0.5</span>
        <span class="n">binary_indicators</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_values_of_units</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># Create a figure with 2 subplots (2 rows, 1 column)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">plot_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>  <span class="c1"># Set the overall title for the plot</span>

        <span class="c1"># First subplot for the maximum values of each signal</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">patterns_tensor</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">max_values_of_units</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s1">'steps-mid'</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Pattern Number'</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Max Value of Signal Units'</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>  <span class="c1"># Adjust y-axis limits for clarity</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Second subplot for the binary indicators</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">patterns_tensor</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">binary_indicators</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s1">'steps-mid'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Pattern Number'</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Indicator (Max &gt; 0.5) in each signal'</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>  <span class="c1"># Adjust y-axis limits for clarity</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">perform_quadratic_regression</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="c1"># Perform quadratic regression</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Coefficients of the polynomial</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">epoch_list</span><span class="p">)</span>        <span class="c1"># Evaluate the polynomial at the given x values</span>
    <span class="k">return</span> <span class="n">y_pred</span>


<span class="k">def</span><span class="w"> </span><span class="nf">pre_train_plots</span><span class="p">(</span><span class="n">epoch_1_order</span><span class="p">,</span> <span class="n">epoch_2_order</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">max_values_indices</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Plots the training progress with regression lines and scatter plots of indices and values of max elements.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - epoch_list (list): List of epoch numbers.</span>
<span class="sd">    - epoch_1_order (list): Loss values for the first-order network over epochs.</span>
<span class="sd">    - epoch_2_order (list): Loss values for the second-order network over epochs.</span>
<span class="sd">    - title (str): Title for the plots.</span>
<span class="sd">    - max_values_indices (tuple): Tuple containing lists of max values and indices for both tensors.</span>
<span class="sd">    """</span>
    <span class="p">(</span><span class="n">max_values_output_first_order</span><span class="p">,</span>
     <span class="n">max_indices_output_first_order</span><span class="p">,</span>
     <span class="n">max_values_patterns_tensor</span><span class="p">,</span>
     <span class="n">max_indices_patterns_tensor</span><span class="p">)</span> <span class="o">=</span> <span class="n">max_values_indices</span>

    <span class="c1"># Perform quadratic regression for the loss plots</span>
    <span class="n">epoch_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">epoch_1_order</span><span class="p">)))</span>
    <span class="n">y_pred1</span> <span class="o">=</span> <span class="n">perform_quadratic_regression</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">,</span> <span class="n">epoch_1_order</span><span class="p">)</span>
    <span class="n">y_pred2</span> <span class="o">=</span> <span class="n">perform_quadratic_regression</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">,</span> <span class="n">epoch_2_order</span><span class="p">)</span>

    <span class="c1"># Set up the plot with 2 rows and 2 columns</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># First graph for 1st Order Network</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">,</span> <span class="n">epoch_1_order</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'g'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">,</span> <span class="n">y_pred1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'-'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Quadratic Fit'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">'1st Order Network'</span><span class="p">,</span> <span class="s1">'Quadratic Fit'</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'1st Order Network Loss'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Epochs - Pretraining Phase'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span>

    <span class="c1"># Second graph for 2nd Order Network</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">,</span> <span class="n">epoch_2_order</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">,</span> <span class="n">y_pred2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'-'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Quadratic Fit'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">'2nd Order Network'</span><span class="p">,</span> <span class="s1">'Quadratic Fit'</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'2nd Order Network Loss'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Epochs - Pretraining Phase'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span>

    <span class="c1"># Scatter plot of indices: patterns_tensor vs. output_first_order</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">max_indices_patterns_tensor</span><span class="p">,</span> <span class="n">max_indices_output_first_order</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Add quadratic regression line</span>
    <span class="n">indices_regression</span> <span class="o">=</span> <span class="n">perform_quadratic_regression</span><span class="p">(</span><span class="n">max_indices_patterns_tensor</span><span class="p">,</span> <span class="n">max_indices_output_first_order</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">max_indices_patterns_tensor</span><span class="p">,</span> <span class="n">indices_regression</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'skyblue'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Quadratic Fit'</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Stimuli location: First Order Input vs. First Order Output'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'First Order Input Indices'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'First Order Output Indices'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Scatter plot of values: patterns_tensor vs. output_first_order</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">max_values_patterns_tensor</span><span class="p">,</span> <span class="n">max_values_output_first_order</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Add quadratic regression line</span>
    <span class="n">values_regression</span> <span class="o">=</span> <span class="n">perform_quadratic_regression</span><span class="p">(</span><span class="n">max_values_patterns_tensor</span><span class="p">,</span> <span class="n">max_values_output_first_order</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">max_values_patterns_tensor</span><span class="p">,</span> <span class="n">values_regression</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'skyblue'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Quadratic Fit'</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Stimuli Values: First Order Input vs. First Order Output'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'First Order Input Values'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'First Order Output Values'</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>

    <span class="c1"># Display the plots in a 2x2 grid</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'Blindsight_Pre_training_Loss_</span><span class="si">{}</span><span class="s1">.png'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">'tight'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="c1"># Function to configure the training environment and load the models</span>
<span class="k">def</span><span class="w"> </span><span class="nf">config_training</span><span class="p">(</span><span class="n">first_order_network</span><span class="p">,</span> <span class="n">second_order_network</span><span class="p">,</span> <span class="n">hidden</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">gelu</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Configures the training environment by saving the state of the given models and loading them back.</span>
<span class="sd">    Initializes testing patterns for evaluation.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - first_order_network: The first order network instance.</span>
<span class="sd">    - second_order_network: The second order network instance.</span>
<span class="sd">    - hidden: Number of hidden units in the first order network.</span>
<span class="sd">    - factor: Factor influencing the network's architecture.</span>
<span class="sd">    - gelu: Activation function to be used in the network.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - Tuple of testing patterns, number of samples in the testing patterns, and the loaded model instances.</span>
<span class="sd">    """</span>
    <span class="c1"># Paths where the models' states will be saved</span>
    <span class="n">PATH</span> <span class="o">=</span> <span class="s1">'./cnn1.pth'</span>
    <span class="n">PATH_2</span> <span class="o">=</span> <span class="s1">'./cnn2.pth'</span>

    <span class="c1"># Save the weights of the pretrained networks to the specified paths</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">first_order_network</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">PATH</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">second_order_network</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">PATH_2</span><span class="p">)</span>

    <span class="c1"># Generating testing patterns for three different sets</span>
    <span class="n">First_set</span><span class="p">,</span> <span class="n">First_set_targets</span> <span class="o">=</span> <span class="n">create_patterns</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>
    <span class="n">Second_set</span><span class="p">,</span> <span class="n">Second_set_targets</span> <span class="o">=</span> <span class="n">create_patterns</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>
    <span class="n">Third_set</span><span class="p">,</span> <span class="n">Third_set_targets</span> <span class="o">=</span> <span class="n">create_patterns</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>

    <span class="c1"># Aggregate testing patterns and their targets for ease of access</span>
    <span class="n">Testing_patterns</span> <span class="o">=</span> <span class="p">[[</span><span class="n">First_set</span><span class="p">,</span> <span class="n">First_set_targets</span><span class="p">],</span> <span class="p">[</span><span class="n">Second_set</span><span class="p">,</span> <span class="n">Second_set_targets</span><span class="p">],</span> <span class="p">[</span><span class="n">Third_set</span><span class="p">,</span> <span class="n">Third_set_targets</span><span class="p">]]</span>

    <span class="c1"># Determine the number of samples from the first set (assumed consistent across all sets)</span>
    <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Testing_patterns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Initialize and load the saved states into model instances</span>
    <span class="n">loaded_model</span> <span class="o">=</span> <span class="n">FirstOrderNetwork</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">gelu</span><span class="p">)</span>
    <span class="n">loaded_model_2</span> <span class="o">=</span> <span class="n">SecondOrderNetwork</span><span class="p">(</span><span class="n">gelu</span><span class="p">)</span>

    <span class="n">loaded_model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">PATH</span><span class="p">))</span>
    <span class="n">loaded_model_2</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">PATH_2</span><span class="p">))</span>

    <span class="c1"># Ensure the models are moved to the appropriate device (CPU/GPU) and set to evaluation mode</span>
    <span class="n">loaded_model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">loaded_model_2</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="n">loaded_model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">loaded_model_2</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">Testing_patterns</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">loaded_model</span><span class="p">,</span> <span class="n">loaded_model_2</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="set-device-gpu-or-cpu">
<h2>Set device (GPU or CPU)<a class="headerlink" href="#set-device-gpu-or-cpu" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Set device (GPU or CPU)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">set_device</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Determines and sets the computational device for PyTorch operations based on the availability of a CUDA-capable GPU.</span>

<span class="sd">    Outputs:</span>
<span class="sd">    - device (str): The device that PyTorch will use for computations ('cuda' or 'cpu'). This string can be directly used</span>
<span class="sd">    in PyTorch operations to specify the device.</span>
<span class="sd">    """</span>

    <span class="n">device</span> <span class="o">=</span> <span class="s2">"cuda"</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">"cpu"</span>
    <span class="k">if</span> <span class="n">device</span> <span class="o">!=</span> <span class="s2">"cuda"</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"GPU is not enabled in this notebook. </span><span class="se">\n</span><span class="s2">"</span>
              <span class="s2">"If you want to enable it, in the menu under `Runtime` -&gt; </span><span class="se">\n</span><span class="s2">"</span>
              <span class="s2">"`Hardware accelerator.` and select `GPU` from the dropdown menu"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"GPU is enabled in this notebook. </span><span class="se">\n</span><span class="s2">"</span>
              <span class="s2">"If you want to disable it, in the menu under `Runtime` -&gt; </span><span class="se">\n</span><span class="s2">"</span>
              <span class="s2">"`Hardware accelerator.` and select `None` from the dropdown menu"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">device</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<hr class="docutils"/>
<section class="tex2jax_ignore mathjax_ignore" id="section-1-global-neuronal-workspace">
<h1>Section 1: Global Neuronal Workspace<a class="headerlink" href="#section-1-global-neuronal-workspace" title="Permalink to this heading">#</a></h1>
<p>Before we get started, we will hear from Claire and Guillaume, who will talk a bit about the neural correlates of consciousness, their research using the global workspace model, and its implications for distinguishing conscious from non-conscious processing.</p>
<section id="video-1-global-neuronal-workspace">
<h2>Video 1: Global Neuronal Workspace<a class="headerlink" href="#video-1-global-neuronal-workspace" title="Permalink to this heading">#</a></h2>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "6cb0666fc4b54d95ab84e3342bb66098"}</script></div>
</div>
</section>
<section id="submit-your-feedback">
<h2>Submit your feedback<a class="headerlink" href="#submit-your-feedback" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Video_1"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "71677f917e70448e91233b556b3de949"}</script></div>
</div>
</section>
<section id="video-2-global-neuronal-workspace">
<h2>Video 2: Global Neuronal Workspace<a class="headerlink" href="#video-2-global-neuronal-workspace" title="Permalink to this heading">#</a></h2>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "62eef30b8bc340d78022af503c72911c"}</script></div>
</div>
</section>
<section id="id1">
<h2>Submit your feedback<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Video_2"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "2f42f60c6fbe460ca527b7a88966b288"}</script></div>
</div>
</section>
<hr class="docutils"/>
<section id="section-1a-modularity-of-the-mind">
<h2>Section 1a: Modularity Of The Mind<a class="headerlink" href="#section-1a-modularity-of-the-mind" title="Permalink to this heading">#</a></h2>
<section id="video-3-modularity-of-the-mind">
<h3>Video 3: Modularity Of The Mind<a class="headerlink" href="#video-3-modularity-of-the-mind" title="Permalink to this heading">#</a></h3>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "1d2035d22f424b1abf3c935c43114d3c"}</script></div>
</div>
</section>
<section id="id2">
<h3>Submit your feedback<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Video_3"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "59b5ba92889e41f48b81ed84847de93c"}</script></div>
</div>
<p>In this section, we are exploring an important concept in machine learning: the idea that the complexity we observe in the physical world often arises from simpler, independently functioning parts. Think of the world as being made up of different modules or units that usually operate on their own but sometimes interact with each other. This is similar to how different apps on your phone work independently but can share information when needed.</p>
<p>This idea is closely linked to the field of causal inference, which studies how these separate units or mechanisms cause and influence each other. The goal is to understand and model how these mechanisms work both individually and together. Importantly, these mechanisms often interact only minimally, which means they can keep working properly even if changes occur in other parts. This characteristic makes them very robust, or capable of handling disturbances well.</p>
<p>A specific example from machine learning that uses this idea is called Recurrent Independent Mechanisms (RIMs). In RIMs, different parts of the model mostly work independently, but they can also communicate or “pay attention” to each other when it’s necessary. This setup allows for efficient and dynamic processing of information. The research paper available here (https://arxiv.org/pdf/1909.10893) discusses this approach in detail. It highlights the benefits of designing models that recognize and utilize the independence and occasional interactions of these mechanisms. Such models are often more adaptable and can generalize better, meaning they perform well across a variety of different tasks or situations.</p>
</section>
<section id="rims">
<h3>RIMs<a class="headerlink" href="#rims" title="Permalink to this heading">#</a></h3>
<p>RIM networks are a type of recurrent neural network that process temporal sequences. Inputs are processed one element at a time, the different units of the network process the inputs, a hidden state is updated and propagated through time. RIM networks can thus be used as a drop-in replacement for RNNs like LSTMs or GRUs. The key differences are that:</p>
<ol class="arabic simple">
<li><p>The RIM cells are sparsely activated, meaning that only a subset of the RIM units are active at each time step.</p></li>
<li><p>The RIM units are mostly independent, meaning that they do not share weights or hidden states.</p></li>
<li><p>The RIM units can communicate with each other through an attention mechanism.</p></li>
</ol>
<p><strong>Selecting the input</strong></p>
<p>Each RIM unit gets activated and updated when the input is pertinent to it. Using key-value attention, the queries originate from the RIMs, while the keys and values are derived from the current input. The key-value attention mechanisms enable dynamic selection of which variable instance (i.e., which entity or object) will serve as input to each RIM mechanism:</p>
<div class="math notranslate nohighlight">
\[
\text{Attention}(Q, K, V) = \text{softmax}\left(\frac{Q K^T}{\sqrt{d}}\right) V
\]</div>
<p>Linear transformations are used to construct keys <span class="math notranslate nohighlight">\(K = XW^e \)</span>, values <span class="math notranslate nohighlight">\( V = XW^v \)</span> and queries <span class="math notranslate nohighlight">\(Q = h_t W^q_k\)</span>.</p>
<p>Here:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( W^v \)</span> is a matrix mapping from an input element to the corresponding value vector for the weighted attention</p></li>
<li><p><span class="math notranslate nohighlight">\( W^e \)</span> is a weight matrix which maps the input to the keys.</p></li>
<li><p><span class="math notranslate nohighlight">\( W^q_k \)</span> is a per-RIM weight matrix which maps from the RIM’s hidden state to its queries.</p></li>
<li><p><span class="math notranslate nohighlight">\(h_t\)</span> is the hidden state for a RIM mechanism.</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\oplus\)</span> refers to the row-level concatenation operator. The attention thus is:</p>
<div class="math notranslate nohighlight">
\[
A^{(\text{in})}_k = \text{softmax}\left(\frac{h_t W^q_k (XW^e)^T}{\sqrt{d_e}}\right) XW^v, \text{ where } \theta^{(\text{in})}_k = (W^q_k, W^e, W^v)
\]</div>
<p>At each step, the top-k RIMs are selected based on their attention scores for the actual input. Essentially, the RIMs compete at each step to read from the input, and only the RIMs that prevail in this competition are allowed to read from the input and update their state.</p>
<p><img alt="Picture which shows how RIMs work over two steps." src="https://github.com/neuromatch/NeuroAI_Course/blob/main/tutorials/W2D5_Mysteries/static/RIMs.png?raw=true"/></p>
<p>This figure shows how RIMs work over two steps.</p>
<ul class="simple">
<li><p>Query generation: each RIM starts by creating a query. This query helps each RIM pull out the necessary information from the data it receives at that moment.</p></li>
<li><p>Attention-based selection: on the right side of the figure, you can see that some RIMs are chosen to be active (colored in blue) and others stay inactive (colored in white). This selection is made using a special scoring system called attention, which picks RIMs based on how relevant they are to the current visual inputs.</p></li>
<li><p>State transition for active RIMs: the RIMs that get activated update their internal states according to their specific rules, using the information they’ve gathered. The RIMs that aren’t activated don’t change and keep their previous states.</p></li>
<li><p>Communication between RIMs: finally, the active RIMs share information with each other, but this communication is limited. They use a system similar to key-value pairing, which helps them share only the most important information needed for the next step.</p></li>
</ul>
<p>To make this more concrete, consider the example of modeling the motion of two balls. We can think of each ball as an independent mechanism. Although both balls are affected by Earth’s gravity, and very slightly by each other, they generally move independently. They only interact significantly when they collide. This model captures the essence of independent mechanisms interacting sparsely, a key idea in developing more effective and generalizable AI systems.</p>
<p>Now, let’s download the RIM model!</p>
<section id="data-retrieval">
<h4>Data retrieval<a class="headerlink" href="#data-retrieval" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Data retrieval</span>
<span class="c1"># @markdown</span>

<span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">redirect_stdout</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()):</span>
    <span class="c1"># URL of the repository to clone</span>
    <span class="o">!</span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/SamueleBolotta/RIMs-Sequential-MNIST
    <span class="o">%</span><span class="k">cd</span> RIMs-Sequential-MNIST

<span class="c1"># Imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">data</span><span class="w"> </span><span class="kn">import</span> <span class="n">MnistData</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">networks</span><span class="w"> </span><span class="kn">import</span> <span class="n">MnistModel</span><span class="p">,</span> <span class="n">LSTM</span>

<span class="c1"># Function to download files</span>
<span class="k">def</span><span class="w"> </span><span class="nf">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Starting to download </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">destination</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Successfully downloaded </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">destination</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Path of the models</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'LSTM'</span><span class="p">:</span> <span class="s1">'lstm_model_dir/lstm_best_model.pt'</span><span class="p">,</span>
    <span class="s1">'RIM'</span><span class="p">:</span> <span class="s1">'rim_model_dir/best_model.pt'</span>
<span class="p">}</span>

<span class="c1"># URLs of the models</span>
<span class="n">model_urls</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'LSTM'</span><span class="p">:</span> <span class="s1">'https://osf.io/4gajq/download'</span><span class="p">,</span>
    <span class="s1">'RIM'</span><span class="p">:</span> <span class="s1">'https://osf.io/3squn/download'</span>
<span class="p">}</span>

<span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">redirect_stdout</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()):</span>
    <span class="c1"># Check if model files exist, if not, download them</span>
    <span class="k">for</span> <span class="n">model_key</span><span class="p">,</span> <span class="n">model_url</span> <span class="ow">in</span> <span class="n">model_urls</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_path</span><span class="p">[</span><span class="n">model_key</span><span class="p">]):</span>
            <span class="n">download_file</span><span class="p">(</span><span class="n">model_url</span><span class="p">,</span> <span class="n">model_path</span><span class="p">[</span><span class="n">model_key</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">model_key</span><span class="si">}</span><span class="s2"> model downloaded."</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">model_key</span><span class="si">}</span><span class="s2"> model already exists. No download needed."</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
</div>
</div>
<p><strong>Training RIMs</strong></p>
<p>RIMs are motivated by the hypothesis that generalization performance can benefit from modules that only activate on relevant parts of the sequence. To measure RIMs’ ability to perform tasks out-of-distribution, we consider the task of classifying MNIST digits as sequences of pixels (Sequential MNIST) and assess generalization to images of resolutions different from those seen during training. The intuition is that the RIMs model should have distinct subsets of the RIMs activated for pixels containing the digit and for empty pixels. RIMs should generalize better to higher resolutions by keeping dormant those RIMs that store pixel information over empty regions of the image.</p>
<p>This is the test setup:</p>
<ol class="arabic simple">
<li><p>Train on 14x14 images of MNIST digits</p></li>
<li><p>Test on:</p>
<ul class="simple">
<li><p>16x16 images (validation set 1)</p></li>
<li><p>19x19 images (validation set 2)</p></li>
<li><p>24x24 images (validation set 3)</p></li>
</ul>
</li>
</ol>
<p>This approach helps to understand whether the model can still recognize the digits accurately even when they appear at different scales or resolutions than those on which it was originally trained. By testing the model on various image sizes, we can determine how flexible and effective the model is at dealing with variations in input data.</p>
<p>Note: if you train the model locally, it will take around 10 minutes to complete.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">redirect_stdout</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()):</span>
    <span class="c1"># Config</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'cuda'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'epochs'</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s1">'batch_size'</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
        <span class="s1">'hidden_size'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">'input_size'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">'model'</span><span class="p">:</span> <span class="s1">'RIM'</span><span class="p">,</span> <span class="c1"># Or 'RIM' for the MnistModel</span>
        <span class="s1">'train'</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># Set to False to load the saved model</span>
        <span class="s1">'num_units'</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s1">'rnn_cell'</span><span class="p">:</span> <span class="s1">'LSTM'</span><span class="p">,</span>
        <span class="s1">'key_size_input'</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
        <span class="s1">'value_size_input'</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
        <span class="s1">'query_size_input'</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
        <span class="s1">'num_input_heads'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">'num_comm_heads'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">'input_dropout'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="s1">'comm_dropout'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="s1">'key_size_comm'</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
        <span class="s1">'value_size_comm'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">'query_size_comm'</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
        <span class="s1">'k'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">'size'</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
        <span class="s1">'loadsaved'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># Ensure this is 1 to load saved model</span>
        <span class="s1">'log_dir'</span><span class="p">:</span> <span class="s1">'rim_model_dir'</span>
    <span class="p">}</span>

    <span class="c1"># Choose the model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MnistModel</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>  <span class="c1"># Instantiating MnistModel (RIM) with config</span>
    <span class="n">model_directory</span> <span class="o">=</span> <span class="n">model_path</span><span class="p">[</span><span class="s1">'RIM'</span><span class="p">]</span>

    <span class="c1"># Set device</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">set_device</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="c1"># Set the map_location based on whether CUDA is available</span>
    <span class="n">map_location</span> <span class="o">=</span> <span class="s1">'cuda'</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="ow">and</span> <span class="n">config</span><span class="p">[</span><span class="s1">'cuda'</span><span class="p">]</span> <span class="k">else</span> <span class="s1">'cpu'</span>

    <span class="c1"># Use torch.load with the map_location parameter</span>
    <span class="n">saved</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_directory</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">map_location</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">saved</span><span class="p">[</span><span class="s1">'net'</span><span class="p">])</span>

    <span class="c1"># Data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">MnistData</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">'batch_size'</span><span class="p">],</span> <span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">'size'</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">'size'</span><span class="p">]),</span> <span class="n">config</span><span class="p">[</span><span class="s1">'k'</span><span class="p">])</span>

    <span class="c1"># Evaluation function</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">loader</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Total validation samples: </span><span class="si">{</span><span class="n">loader</span><span class="o">.</span><span class="n">val_len</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>  <span class="c1"># Print total number of validation samples</span>

        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">val_len</span><span class="p">())):</span>
                <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">test_x</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_device</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
                <span class="n">test_y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_device</span><span class="p">(</span><span class="n">test_y</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
                <span class="n">probs</span>  <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
                <span class="n">preds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">correct</span> <span class="o">=</span> <span class="n">preds</span> <span class="o">==</span> <span class="n">test_y</span>
                <span class="n">accuracy</span> <span class="o">+=</span> <span class="n">correct</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

        <span class="n">accuracy</span> <span class="o">/=</span> <span class="mi">100</span>  <span class="c1"># Use the total number of items in the validation set for accuracy calculation</span>
        <span class="k">return</span> <span class="n">accuracy</span>


    <span class="c1"># Evaluate on all three validation sets</span>
    <span class="n">validation_functions</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">val_get1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">val_get2</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">val_get3</span><span class="p">]</span>
    <span class="n">validation_accuracies_rim</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Model: </span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">'model'</span><span class="p">]</span><span class="si">}</span><span class="s2">, Device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Configuration: </span><span class="si">{</span><span class="n">config</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">validation_functions</span><span class="p">:</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">test_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="n">validation_accuracies_rim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">line</span> <span class="mi">77</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Configuration: </span><span class="si">{</span><span class="n">config</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">validation_functions</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">77</span>     <span class="n">accuracy</span> <span class="o">=</span> <span class="n">test_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span>     <span class="n">validation_accuracies_rim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>

<span class="nn">Cell In[15], line 60,</span> in <span class="ni">test_model</span><span class="nt">(model, loader, func)</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span> <span class="n">test_x</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_device</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_device</span><span class="p">(</span><span class="n">test_y</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">60</span> <span class="n">probs</span>  <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span> <span class="n">preds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span> <span class="n">correct</span> <span class="o">=</span> <span class="n">preds</span> <span class="o">==</span> <span class="n">test_y</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.22/x64/lib/python3.9/site-packages/torch/nn/modules/module.py:1518,</span> in <span class="ni">Module._wrapped_call_impl</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1516</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiled_call_impl</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore[misc]</span>
<span class="g g-Whitespace">   </span><span class="mi">1517</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1518</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_impl</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.22/x64/lib/python3.9/site-packages/torch/nn/modules/module.py:1527,</span> in <span class="ni">Module._call_impl</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1522</span> <span class="c1"># If we don't have any hooks, we want to skip the rest of the logic in</span>
<span class="g g-Whitespace">   </span><span class="mi">1523</span> <span class="c1"># this function, and just call forward.</span>
<span class="g g-Whitespace">   </span><span class="mi">1524</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backward_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backward_pre_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_pre_hooks</span>
<span class="g g-Whitespace">   </span><span class="mi">1525</span>         <span class="ow">or</span> <span class="n">_global_backward_pre_hooks</span> <span class="ow">or</span> <span class="n">_global_backward_hooks</span>
<span class="g g-Whitespace">   </span><span class="mi">1526</span>         <span class="ow">or</span> <span class="n">_global_forward_hooks</span> <span class="ow">or</span> <span class="n">_global_forward_pre_hooks</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1527</span>     <span class="k">return</span> <span class="n">forward_call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1529</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1530</span>     <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nn">File ~/work/NeuroAI_Course/NeuroAI_Course/tutorials/W2D5_Mysteries/student/RIMs-Sequential-MNIST/networks.py:32,</span> in <span class="ni">MnistModel.forward</span><span class="nt">(self, x, y)</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="c1"># pass through RIMCell for all timesteps</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">32</span> 	<span class="n">hs</span><span class="p">,</span> <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rim_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hs</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> 	<span class="c1"># Compute Loss</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.22/x64/lib/python3.9/site-packages/torch/nn/modules/module.py:1518,</span> in <span class="ni">Module._wrapped_call_impl</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1516</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiled_call_impl</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore[misc]</span>
<span class="g g-Whitespace">   </span><span class="mi">1517</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1518</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_impl</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.22/x64/lib/python3.9/site-packages/torch/nn/modules/module.py:1527,</span> in <span class="ni">Module._call_impl</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1522</span> <span class="c1"># If we don't have any hooks, we want to skip the rest of the logic in</span>
<span class="g g-Whitespace">   </span><span class="mi">1523</span> <span class="c1"># this function, and just call forward.</span>
<span class="g g-Whitespace">   </span><span class="mi">1524</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backward_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backward_pre_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_pre_hooks</span>
<span class="g g-Whitespace">   </span><span class="mi">1525</span>         <span class="ow">or</span> <span class="n">_global_backward_pre_hooks</span> <span class="ow">or</span> <span class="n">_global_backward_hooks</span>
<span class="g g-Whitespace">   </span><span class="mi">1526</span>         <span class="ow">or</span> <span class="n">_global_forward_hooks</span> <span class="ow">or</span> <span class="n">_global_forward_pre_hooks</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1527</span>     <span class="k">return</span> <span class="n">forward_call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1529</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1530</span>     <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nn">File ~/work/NeuroAI_Course/NeuroAI_Course/tutorials/W2D5_Mysteries/student/RIMs-Sequential-MNIST/RIM.py:233,</span> in <span class="ni">RIMCell.forward</span><span class="nt">(self, x, hs, cs)</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span> <span class="c1"># Compute RNN(LSTM or GRU) output</span>
<span class="g g-Whitespace">    </span><span class="mi">232</span> <span class="k">if</span> <span class="n">cs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">233</span> 	<span class="n">hs</span><span class="p">,</span> <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="p">(</span><span class="n">hs</span><span class="p">,</span> <span class="n">cs</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">234</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">235</span> 	<span class="n">hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">hs</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.22/x64/lib/python3.9/site-packages/torch/nn/modules/module.py:1518,</span> in <span class="ni">Module._wrapped_call_impl</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1516</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiled_call_impl</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore[misc]</span>
<span class="g g-Whitespace">   </span><span class="mi">1517</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1518</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_impl</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.22/x64/lib/python3.9/site-packages/torch/nn/modules/module.py:1527,</span> in <span class="ni">Module._call_impl</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1522</span> <span class="c1"># If we don't have any hooks, we want to skip the rest of the logic in</span>
<span class="g g-Whitespace">   </span><span class="mi">1523</span> <span class="c1"># this function, and just call forward.</span>
<span class="g g-Whitespace">   </span><span class="mi">1524</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backward_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backward_pre_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_pre_hooks</span>
<span class="g g-Whitespace">   </span><span class="mi">1525</span>         <span class="ow">or</span> <span class="n">_global_backward_pre_hooks</span> <span class="ow">or</span> <span class="n">_global_backward_hooks</span>
<span class="g g-Whitespace">   </span><span class="mi">1526</span>         <span class="ow">or</span> <span class="n">_global_forward_hooks</span> <span class="ow">or</span> <span class="n">_global_forward_pre_hooks</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1527</span>     <span class="k">return</span> <span class="n">forward_call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1529</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1530</span>     <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nn">File ~/work/NeuroAI_Course/NeuroAI_Course/tutorials/W2D5_Mysteries/student/RIMs-Sequential-MNIST/RIM.py:52,</span> in <span class="ni">GroupLSTMCell.forward</span><span class="nt">(self, x, hid_state)</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span><span class="w"> </span><span class="sd">"""</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span><span class="sd"> input: x (batch_size, num_lstms, input_size)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span><span class="sd"> 	   hid_state (tuple of length 2 with each element of size (batch_size, num_lstms, hidden_state))</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span><span class="sd"> output: h (batch_size, num_lstms, hidden_state)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span><span class="sd"> 		c ((batch_size, num_lstms, hidden_state))</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span><span class="sd"> """</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span> <span class="n">h</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">hid_state</span>
<span class="ne">---&gt; </span><span class="mi">52</span> <span class="n">preact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i2h</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">h2h</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">54</span> <span class="n">gates</span> <span class="o">=</span> <span class="n">preact</span><span class="p">[:,</span> <span class="p">:,</span>  <span class="p">:</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">]</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span> <span class="n">g_t</span> <span class="o">=</span> <span class="n">preact</span><span class="p">[:,</span> <span class="p">:,</span>  <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_size</span><span class="p">:]</span><span class="o">.</span><span class="n">tanh</span><span class="p">()</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p><strong>Training LSTMs</strong></p>
<p>Let’s now repeat the same process with LSTMs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">redirect_stdout</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()):</span>
    <span class="c1"># Config</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'cuda'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'epochs'</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s1">'batch_size'</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
        <span class="s1">'hidden_size'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">'input_size'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">'model'</span><span class="p">:</span> <span class="s1">'LSTM'</span><span class="p">,</span>
        <span class="s1">'train'</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># Set to False to load the saved model</span>
        <span class="s1">'num_units'</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s1">'rnn_cell'</span><span class="p">:</span> <span class="s1">'LSTM'</span><span class="p">,</span>
        <span class="s1">'key_size_input'</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
        <span class="s1">'value_size_input'</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
        <span class="s1">'query_size_input'</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
        <span class="s1">'num_input_heads'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">'num_comm_heads'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">'input_dropout'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="s1">'comm_dropout'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="s1">'key_size_comm'</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
        <span class="s1">'value_size_comm'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">'query_size_comm'</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
        <span class="s1">'k'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">'size'</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
        <span class="s1">'loadsaved'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># Ensure this is 1 to load saved model</span>
        <span class="s1">'log_dir'</span><span class="p">:</span> <span class="s1">'rim_model_dir'</span>
    <span class="p">}</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>  <span class="c1"># Instantiating LSTM with config</span>
    <span class="n">model_directory</span> <span class="o">=</span> <span class="n">model_path</span><span class="p">[</span><span class="s1">'LSTM'</span><span class="p">]</span>

    <span class="c1"># Set device</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">set_device</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="c1"># Set the map_location based on whether CUDA is available</span>
    <span class="n">map_location</span> <span class="o">=</span> <span class="s1">'cuda'</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="ow">and</span> <span class="n">config</span><span class="p">[</span><span class="s1">'cuda'</span><span class="p">]</span> <span class="k">else</span> <span class="s1">'cpu'</span>

    <span class="c1"># Use torch.load with the map_location parameter</span>
    <span class="n">saved</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_directory</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">map_location</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">saved</span><span class="p">[</span><span class="s1">'net'</span><span class="p">])</span>

    <span class="c1"># Data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">MnistData</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">'batch_size'</span><span class="p">],</span> <span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">'size'</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">'size'</span><span class="p">]),</span> <span class="n">config</span><span class="p">[</span><span class="s1">'k'</span><span class="p">])</span>

    <span class="c1"># Evaluation function</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">loader</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Total validation samples: </span><span class="si">{</span><span class="n">loader</span><span class="o">.</span><span class="n">val_len</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>  <span class="c1"># Print total number of validation samples</span>

        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">val_len</span><span class="p">())):</span>
                <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">test_x</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_device</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
                <span class="n">test_y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_device</span><span class="p">(</span><span class="n">test_y</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
                <span class="n">probs</span>  <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
                <span class="n">preds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">correct</span> <span class="o">=</span> <span class="n">preds</span> <span class="o">==</span> <span class="n">test_y</span>
                <span class="n">accuracy</span> <span class="o">+=</span> <span class="n">correct</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

        <span class="n">accuracy</span> <span class="o">/=</span> <span class="mi">100</span>  <span class="c1"># Use the total number of items in the validation set for accuracy calculation</span>
        <span class="k">return</span> <span class="n">accuracy</span>


    <span class="c1"># Evaluate on all three validation sets</span>
    <span class="n">validation_functions</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">val_get1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">val_get2</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">val_get3</span><span class="p">]</span>
    <span class="n">validation_accuracies_lstm</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Model: </span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">'model'</span><span class="p">]</span><span class="si">}</span><span class="s2">, Device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Configuration: </span><span class="si">{</span><span class="n">config</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">validation_functions</span><span class="p">:</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">test_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="n">validation_accuracies_lstm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>

    <span class="c1"># Define the image sizes</span>
    <span class="n">image_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"16x16"</span><span class="p">,</span> <span class="s2">"19x19"</span><span class="p">,</span> <span class="s2">"24x24"</span><span class="p">]</span>

    <span class="c1"># Reverse the order of the lists</span>
    <span class="n">validation_accuracies_rim_reversed</span> <span class="o">=</span> <span class="n">validation_accuracies_rim</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">validation_accuracies_lstm_reversed</span> <span class="o">=</span> <span class="n">validation_accuracies_lstm</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print accuracies for all validation sets (RIMs) with image sizes</span>
<span class="k">for</span> <span class="n">size</span><span class="p">,</span> <span class="n">accuracy</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">image_sizes</span><span class="p">,</span> <span class="n">validation_accuracies_rim_reversed</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s1"> images - Accuracy (RIMs): </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%'</span><span class="p">)</span>

<span class="c1"># Print accuracies for all validation sets (LSTMs) with image sizes</span>
<span class="k">for</span> <span class="n">size</span><span class="p">,</span> <span class="n">accuracy</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">image_sizes</span><span class="p">,</span> <span class="n">validation_accuracies_lstm_reversed</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s1"> images - Accuracy (LSTMs): </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The accuracy of the model on 16x16 images is fairly close to what was observed on smaller images, indicating that the increase in size to 16x16 does not significantly impact the model’s ability to recognize the images. However, RIMs demonstrate generalization better, when working with the larger 19x19 and 24x24 images - compared to LSTMs.</p>
</section>
<section id="id3">
<h4>Submit your feedback<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_RIMs_LSTM"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="discussion-point">
<h3>Discussion point<a class="headerlink" href="#discussion-point" title="Permalink to this heading">#</a></h3>
<p>Why do you think a RIM works better than an LSTM in this case?</p>
<p><a class="reference external" href="https://github.com/neuromatch/NeuroAI_Course/tree/main/tutorials/W2D5_Mysteries/solutions/W2D5_Tutorial1_Solution_a617d707.py"><em>Click for solution</em></a></p>
<section id="id4">
<h4>Submit your feedback<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Discussion_point_RIMs"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p><strong>RIMs and consciousness</strong></p>
<p>You might wonder how RIMs relate to consciousness. As we have seen, RIMs focus on modularity in neural processing. In this approach, various modules or units operate semi-independently but coordinate through a mechanism akin to attention. This modularity allows the system to specialize in different tasks, with the attention mechanism directing computational resources efficiently by focusing on the most relevant parts of a problem at any given time.</p>
<p>Like RIMs, the brain is modularly organized. Many theories of consciousness posit that consciousness emerges from the interaction of various specialized, yet relatively independent, neural circuits or modules. Each of these modules processes specific types of information or performs distinct cognitive functions. Global Workspace Theory, which we’ll cover in the next section, is a canonical example of a modular theory of consciousness.</p>
</section>
</section>
</section>
<hr class="docutils"/>
<section id="section-1b-a-shared-workspace">
<h2>Section 1b: A Shared Workspace<a class="headerlink" href="#section-1b-a-shared-workspace" title="Permalink to this heading">#</a></h2>
<section id="video-4-a-shared-workspace">
<h3>Video 4: A Shared Workspace<a class="headerlink" href="#video-4-a-shared-workspace" title="Permalink to this heading">#</a></h3>
<div class="cell tag_remove-input docutils container">
</div>
</section>
<section id="id5">
<h3>Submit your feedback<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Video_4"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>In this section, we explore a deep learning model based on Global Workspace Theory from cognitive neuroscience. You can read more about this model in the linked research paper here (https://arxiv.org/pdf/2103.01197.pdf). The core idea behind this model is the use of a “shared global workspace” which serves as a coordination platform for the various specialized modules within the network.</p>
<p>Essentially, the model incorporates multiple specialist modules, each focusing on different aspects of a problem. Unlike in the RIM mechanism, these modules do not communicate directly with each other, but rather interact through a central shared memory. Communication with the centeral shared memory is handled, once again, by an attention mechanism.</p>
<p><img alt="Picture which shows how a shared workspace mechanism works." src="https://github.com/neuromatch/NeuroAI_Course/blob/main/tutorials/W2D5_Mysteries/static/Shared_Workspace.png?raw=true"/></p>
<p>By centralizing communication this way, the model mimics how a human brain might focus only on the most relevant information at any given time. It mimics a sort of “cognitive economy,” where only the most relevant data is processed and shared among modules, reducing redundancy and enhancing the overall performance of the system. Moreover, the theory embeds some of the assumptions of the Global Workspace Theory (GWT) of consciousness, which suggests that consciousness arises from the ability of various brain processes to access a shared information platform, the <strong>Global Workspace</strong>.</p>
</section>
<section id="coding-exercise-1-creating-a-shared-workspace">
<h3>Coding Exercise 1: Creating a Shared Workspace<a class="headerlink" href="#coding-exercise-1-creating-a-shared-workspace" title="Permalink to this heading">#</a></h3>
<p>In our model, the interaction among the modules (or specialists) and the shared workspace is managed by a key-query-value cross-attention mechanism. Here’s how it works:</p>
<ul class="simple">
<li><p>Key: Each specialist module generates a key which represents the type of information the module wants to share.</p></li>
<li><p>Query: The workspace generates a query at each computational step. This query represents what the workspace needs to know next to facilitate the overall task.</p></li>
<li><p>Value: Each specialist also prepares a value, which is the actual information it proposes to add to the workspace.</p></li>
</ul>
<p>Fill in the code below to implement this mechanism.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># Ensure reproducibility</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SharedWorkspace</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_specialists</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">num_memory_slots</span><span class="p">,</span> <span class="n">memory_slot_dim</span><span class="p">):</span>
        <span class="c1">#################################################</span>
        <span class="c1">## TODO for students: fill in the missing variables ##</span>
        <span class="c1"># Fill out function and remove</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Student exercise: fill in the missing variables"</span><span class="p">)</span>
        <span class="c1">#################################################</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_specialists</span> <span class="o">=</span> <span class="n">num_specialists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_dim</span> <span class="o">=</span> <span class="n">hidden_dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_memory_slots</span> <span class="o">=</span> <span class="n">num_memory_slots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_slot_dim</span> <span class="o">=</span> <span class="n">memory_slot_dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workspace_memory</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_memory_slots</span><span class="p">,</span> <span class="n">memory_slot_dim</span><span class="p">))</span>

        <span class="c1"># Attention mechanism components for writing to the workspace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">memory_slot_dim</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_to_workspace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specialists_states</span><span class="p">):</span>
        <span class="c1">#################################################</span>
        <span class="c1">## TODO for students: fill in the missing variables ##</span>
        <span class="c1"># Fill out function and remove</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Student exercise: fill in the missing variables"</span><span class="p">)</span>
        <span class="c1">#################################################</span>
        <span class="c1"># Flatten specialists' states if they're not already</span>
        <span class="n">specialists_states</span> <span class="o">=</span> <span class="n">specialists_states</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_dim</span><span class="p">)</span>

        <span class="c1"># Compute key, query, and value</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="n">specialists_states</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_memory</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">specialists_states</span><span class="p">)</span>

        <span class="c1"># Compute attention scores and apply softmax</span>
        <span class="n">attention_scores</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">keys</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_slot_dim</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">attention_probs</span> <span class="o">=</span> <span class="o">...</span>

        <span class="c1"># Update workspace memory with weighted sum of values</span>
        <span class="n">updated_memory</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">attention_probs</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workspace_memory</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">updated_memory</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_memory</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specialists_states</span><span class="p">):</span>
        <span class="c1">#################################################</span>
        <span class="c1">## TODO for students: fill in the missing variables ##</span>
        <span class="c1"># Fill out function and remove</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Student exercise: fill in the missing variables"</span><span class="p">)</span>
        <span class="c1">#################################################</span>
        <span class="n">updated_memory</span> <span class="o">=</span> <span class="o">...</span>
        <span class="k">return</span> <span class="n">updated_memory</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/neuromatch/NeuroAI_Course/tree/main/tutorials/W2D5_Mysteries/solutions/W2D5_Tutorial1_Solution_f1250f89.py"><em>Click for solution</em></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example parameters</span>
<span class="n">num_specialists</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">hidden_dim</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">num_memory_slots</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">memory_slot_dim</span> <span class="o">=</span> <span class="mi">6</span>

<span class="c1"># Generate deterministic specialists' states</span>
<span class="n">specialists_states</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_specialists</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>

<span class="n">workspace</span> <span class="o">=</span> <span class="n">SharedWorkspace</span><span class="p">(</span><span class="n">num_specialists</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">num_memory_slots</span><span class="p">,</span> <span class="n">memory_slot_dim</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>After updating the shared workspace with the most critical signals, this information is then broadcast back to all specialists. Each specialist updates its state using this broadcast information, which can involve an attention mechanism for consolidation and an update function (like an LSTM or GRU step) based on the new combined state. Let’s add this method!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">broadcast_from_workspace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specialists_states</span><span class="p">):</span>
    <span class="c1"># Broadcast updated memory to specialists</span>
    <span class="n">broadcast_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">specialists_states</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_specialists</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_slot_dim</span><span class="p">)</span>
    <span class="n">broadcast_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_memory</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_specialists</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Compute attention scores for broadcasting</span>
    <span class="n">broadcast_attention_scores</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">broadcast_query</span><span class="p">,</span> <span class="n">broadcast_keys</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_slot_dim</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">broadcast_attention_probs</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">broadcast_attention_scores</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Update specialists' states with attention-weighted memory information</span>
    <span class="n">broadcast_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_memory</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_specialists</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">updated_states</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">broadcast_attention_probs</span><span class="p">,</span> <span class="n">broadcast_values</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">updated_states</span><span class="o">.</span><span class="n">view_as</span><span class="p">(</span><span class="n">specialists_states</span><span class="p">)</span>

<span class="c1"># Assign the method to the class</span>
<span class="n">SharedWorkspace</span><span class="o">.</span><span class="n">broadcast_from_workspace</span> <span class="o">=</span> <span class="n">broadcast_from_workspace</span>
</pre></div>
</div>
</div>
</div>
<p>This approach structures the shared workspace to function in a modular fashion:</p>
<ul class="simple">
<li><p>Step 1: Aggregation of specialist states</p></li>
<li><p>Step 2: Competitive information update in the shared workspace</p></li>
<li><p>Step 3: Broadcasting updated information</p></li>
</ul>
<p>After the shared workspace has been updated with the most pertinent information, this consolidated knowledge is then broadcast back to all the specialists. This means that each specialist receives the updated, aggregated information, allowing them to adjust their actions or processing based on the collective insights of the entire system.</p>
<section id="id6">
<h4>Submit your feedback<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Shared_Workspace"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p><strong>Recap</strong></p>
<p>In the past sections, we’ve discussed models like Recurrent Independent Mechanisms (RIMs) and those inspired by cognitive neuroscience’s Global Workspace Theory (GWT). These models embed different ideas about modularity:</p>
<ul class="simple">
<li><p>RIMs are based on the concept of independent mechanisms that can communicate sparsely through an attention mechanism.</p></li>
<li><p>GWT-inspired models use a shared workspace to coordinate between specialized modules.</p></li>
</ul>
<p>These frameworks inspired by the brain embed some of the characteristics of popular models of consciousness. By mimicking how different parts of the brain might communicate and dominate the global workspace at different times, these models provide insight into how conscious awareness and decision-making could emerge in the brain.</p>
</section>
</section>
</section>
</section>
<hr class="docutils"/>
<section class="tex2jax_ignore mathjax_ignore" id="section-2-higher-order-assessment-and-metacognition">
<h1>Section 2: Higher order assessment and metacognition<a class="headerlink" href="#section-2-higher-order-assessment-and-metacognition" title="Permalink to this heading">#</a></h1>
<section id="video-5-higher-order-assessment-and-metacognition">
<h2>Video 5: Higher order assessment and metacognition<a class="headerlink" href="#video-5-higher-order-assessment-and-metacognition" title="Permalink to this heading">#</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
</section>
<section id="id7">
<h2>Submit your feedback<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Video_5"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="second-order-model">
<h2>Second order model<a class="headerlink" href="#second-order-model" title="Permalink to this heading">#</a></h2>
<p>Blindsight is a neurological phenomenon where individuals with damage to their primary visual cortex can still respond to visual stimuli without consciously perceiving them.</p>
<p>To study this, we use a simulated dataset that mimics the conditions of blindsight. This dataset contains 400 patterns, equally split between two types:</p>
<ul class="simple">
<li><p><strong>Random noise patterns</strong> consist of low activations ranging between 0.0 and 0.02.</p></li>
<li><p><strong>Designed stimulus patterns</strong> - each pattern includes one unit that shows a higher activation level, varying between 0.0 and 1.0.</p></li>
</ul>
<p>This dataset allows us to test hypotheses concerning how sensory processing and network responses adapt under different conditions of visual impairment.</p>
<p>We have three main testing scenarios, each designed to alter the signal-to-noise ratio to simulate different levels of visual impairment:</p>
<ul class="simple">
<li><p><strong>Suprathreshold stimulus condition</strong>: here, the network is tested against familiar patterns used during training to assess its response to known stimuli.</p></li>
<li><p><strong>Subthreshold stimulus condition</strong>: this condition slightly increases the noise level, akin to actual blindsight conditions, testing the network’s capability to discern subtle signals.</p></li>
<li><p><strong>Low vision condition</strong>: the intensity of stimuli is decreased to evaluate how well the network performs with significantly reduced sensory input.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">factor</span><span class="o">=</span><span class="mi">2</span>

<span class="n">initialize_global</span><span class="p">()</span>
<span class="n">set_1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_patterns</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>
<span class="n">set_2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_patterns</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>
<span class="n">set_3</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_patterns</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">plot_signal_max_and_indicator</span><span class="p">(</span><span class="n">set_1</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="s2">"Suprathreshold dataset"</span><span class="p">)</span>
<span class="n">plot_signal_max_and_indicator</span><span class="p">(</span><span class="n">set_2</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="s2">"Subthreshold dataset"</span><span class="p">)</span>
<span class="n">plot_signal_max_and_indicator</span><span class="p">(</span><span class="n">set_3</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="s2">"Low Vision dataset"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The first-order network model lays the groundwork for our experiments and is structured as follows:</p>
<ul class="simple">
<li><p>Input layer: consists of 100 units representing either noise or stimulus patterns.</p></li>
<li><p>Hidden layer: includes a 40-unit layer tasked with processing the inputs.</p></li>
<li><p>Output layer: comprises 100 units where the responses to stimuli are recorded.</p></li>
<li><p>Dropout and activation: includes dropout layers to prevent overfitting and a temperature-controlled activation function to fine-tune response sharpness.</p></li>
</ul>
<p>The primary aim of the first-order network is to accurately capture and react to the input patterns, setting a baseline for comparison with more complex models.</p>
<section id="coding-exercise-2-developing-a-second-order-network">
<h3>Coding Exercise 2: Developing a Second-Order Network<a class="headerlink" href="#coding-exercise-2-developing-a-second-order-network" title="Permalink to this heading">#</a></h3>
<p>Your task is to expand upon the first-order network by integrating a second-order network that incorporates a metacognitive layer assessing the predictions of the first-order network. This metacognitive layer introduces a wagering mechanism, wherein the network “bets” on its confidence in its predictions.</p>
<ul class="simple">
<li><p>The first-order network is designed as an autoencoder, a type of neural network trained to reconstruct the input stimulus. The autoencoder consists of an encoder that compresses the input into a latent representation and a decoder that reconstructs the input from this representation.</p></li>
<li><p>The second-order network, or metacognitive layer, operates by examining the difference (delta) between the original input and the output generated by the autoencoder. This difference provides insight into the reconstruction error, which is a measure of how accurately the autoencoder has learned to replicate the input data. By evaluating this reconstruction error, the second-order network can make a judgement about the certainty of the first-order network’s predictions.</p></li>
</ul>
<p>These are the steps for completion:</p>
<ol class="arabic simple">
<li><p>Architectural development: grasp the underlying principles of a second-order network and complete the architectural code.</p></li>
<li><p>Performance evaluation: visualize training losses and test the model using provided code, assessing its initial performance.</p></li>
<li><p>Model fine-tuning: leveraging the provided training function, experiment with fine-tuning the model to enhance its accuracy and efficiency.</p></li>
</ol>
<p>The second-order network is structured as a feedforward backpropagation network.</p>
<ul class="simple">
<li><p>Input layer: comprises a 100-unit comparison matrix. This matrix quantifies the discrepancy between each corresponding pair of input and output units from the first-order network. For example, if an input unit and its corresponding output unit have activations of 0.6 and 0.7, respectively, the comparison unit’s activation would be -0.1. This setup essentially encodes the prediction error of the first-order network’s outputs as an input pattern for the second-order network.</p></li>
<li><p>Output layer: consists of two units representing “high” and “low” wagers, indicating the network’s confidence in its predictions. The initial weights for these output units range between 0.0 and 0.1.</p></li>
<li><p>Comparator weights: set to 1.0 for connections from the first-order input layer to the comparison matrix, and -1.0 for connections from the first-order output layer. This configuration emphasizes the differential error as a critical input for the second-order decision-making process.</p></li>
</ul>
<p>The second-order network’s novel approach uses the error generated by the first-order network as a direct input for making decisions—specifically, wagering on the confidence of its outputs. This methodology reflects a metacognitive layer of processing, akin to evaluating one’s confidence in their answers or predictions.</p>
<p>By exploring these adjustments, you can optimize the network’s functionality, making it a powerful tool for understanding and simulating complex cognitive phenomena like blindsight.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SecondOrderNetwork</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_gelu</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SecondOrderNetwork</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Define a linear layer for comparing the difference between input and output of the first-order network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comparison_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Linear layer for determining wagers, mapping from 100 features to a single output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wager</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Dropout layer to prevent overfitting by randomly setting input units to 0 with a probability of 0.5 during training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># Select activation function based on the `use_gelu` flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span>

        <span class="c1"># Additional activation functions for potential use in network operations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmoid</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Softmax</span><span class="p">()</span>

        <span class="c1"># Initialize the weights of the network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_weights</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Uniformly initialize weights for the comparison and wager layers</span>
        <span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison_layer</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wager</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Uniformly initialize weights for the comparison and wager layers</span>
        <span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison_layer</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wager</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_order_input</span><span class="p">,</span> <span class="n">first_order_output</span><span class="p">):</span>
        <span class="c1">############################################################</span>
        <span class="c1"># Fill in the wager value</span>
        <span class="c1"># Applying dropout and sigmoid activation to the output of the wager layer</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Student exercise"</span><span class="p">)</span>
        <span class="c1">############################################################</span>

        <span class="c1"># Calculate the difference between the first-order input and output</span>
        <span class="n">comparison_matrix</span> <span class="o">=</span> <span class="n">first_order_input</span> <span class="o">-</span> <span class="n">first_order_output</span>

        <span class="c1">#Another option is to directly calculate the per unit MSE to use as input for the comparator matrix</span>
        <span class="c1">#comparison_matrix = nn.MSELoss(reduction='none')(first_order_output, first_order_input)</span>

        <span class="c1"># Pass the difference through the comparison layer and apply the chosen activation function</span>
        <span class="n">comparison_out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison_layer</span><span class="p">(</span><span class="n">comparison_matrix</span><span class="p">)))</span>

        <span class="c1"># Calculate the wager value, applying dropout and sigmoid activation to the output of the wager layer</span>
        <span class="n">wager</span> <span class="o">=</span> <span class="o">...</span>

        <span class="k">return</span> <span class="n">wager</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/neuromatch/NeuroAI_Course/tree/main/tutorials/W2D5_Mysteries/solutions/W2D5_Tutorial1_Solution_a926812a.py"><em>Click for solution</em></a></p>
<section id="id8">
<h4>Submit your feedback<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Second_Order_Network"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hidden</span><span class="o">=</span><span class="mi">40</span>
<span class="n">factor</span><span class="o">=</span><span class="mi">2</span>
<span class="n">gelu</span><span class="o">=</span><span class="kc">False</span>
<span class="n">gam</span><span class="o">=</span><span class="mf">0.98</span>
<span class="n">meta</span><span class="o">=</span><span class="kc">True</span>
<span class="n">stepsize</span><span class="o">=</span><span class="mi">25</span>

<span class="n">initialize_global</span><span class="p">()</span>

<span class="c1"># First order network instantiation</span>
<span class="n">first_order_network</span> <span class="o">=</span> <span class="n">FirstOrderNetwork</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">gelu</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">pre_train</span><span class="p">(</span><span class="n">first_order_network</span><span class="p">,</span> <span class="n">second_order_network</span><span class="p">,</span> <span class="n">criterion_1</span><span class="p">,</span>  <span class="n">criterion_2</span><span class="p">,</span> <span class="n">optimizer_1</span><span class="p">,</span> <span class="n">optimizer_2</span><span class="p">,</span> <span class="n">scheduler_1</span><span class="p">,</span> <span class="n">scheduler_2</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">meta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Conducts pre-training for first-order and second-order networks.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - first_order_network (torch.nn.Module): Network for basic input-output mapping.</span>
<span class="sd">    - second_order_network (torch.nn.Module): Network for decision-making based on the first network's output.</span>
<span class="sd">    - criterion_1, criterion_2 (torch.nn): Loss functions for the respective networks.</span>
<span class="sd">    - optimizer_1, optimizer_2 (torch.optim): Optimizers for the respective networks.</span>
<span class="sd">    - scheduler_1, scheduler_2 (torch.optim.lr_scheduler): Schedulers for learning rate adjustment.</span>
<span class="sd">    - factor (float): Parameter influencing data augmentation or pattern generation.</span>
<span class="sd">    - meta (bool): Flag indicating the use of meta-learning strategies.</span>

<span class="sd">    Returns:</span>
<span class="sd">    Tuple containing updated networks and epoch-wise loss records.</span>

<span class="sd">    """</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_num_args</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span>

    <span class="n">max_values_output_first_order</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_indices_output_first_order</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_values_patterns_tensor</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_indices_patterns_tensor</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">epoch_1_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">)</span>
    <span class="n">epoch_2_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">):</span>
        <span class="c1"># Generate training patterns and targets for each epoch</span>
        <span class="n">patterns_tensor</span><span class="p">,</span> <span class="n">stim_present_tensor</span><span class="p">,</span> <span class="n">stim_absent_tensor</span><span class="p">,</span> <span class="n">order_2_tensor</span> <span class="o">=</span> <span class="n">generate_patterns</span><span class="p">(</span><span class="n">patterns_number</span><span class="p">,</span> <span class="n">num_units</span><span class="p">,</span><span class="n">factor</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Forward pass through the first-order network</span>
        <span class="n">hidden_representation</span> <span class="p">,</span> <span class="n">output_first_order</span> <span class="o">=</span> <span class="n">first_order_network</span><span class="p">(</span><span class="n">patterns_tensor</span><span class="p">)</span>

        <span class="n">patterns_tensor</span><span class="o">=</span><span class="n">patterns_tensor</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">output_first_order</span><span class="o">=</span><span class="n">output_first_order</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Get max values and indices for output_first_order</span>
        <span class="n">max_vals_out</span><span class="p">,</span> <span class="n">max_inds_out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">output_first_order</span><span class="p">[</span><span class="mi">100</span><span class="p">:],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">max_inds_out</span><span class="p">[</span><span class="n">max_vals_out</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_values_output_first_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_vals_out</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">max_indices_output_first_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_inds_out</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="c1"># Get max values and indices for patterns_tensor</span>
        <span class="n">max_vals_pat</span><span class="p">,</span> <span class="n">max_inds_pat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">patterns_tensor</span><span class="p">[</span><span class="mi">100</span><span class="p">:],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">max_inds_pat</span><span class="p">[</span><span class="n">max_vals_pat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_values_patterns_tensor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_vals_pat</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">max_indices_patterns_tensor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_inds_pat</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="n">optimizer_1</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

        <span class="c1"># Conditionally execute the second-order network pass and related operations</span>
        <span class="k">if</span> <span class="n">meta</span><span class="p">:</span>

            <span class="c1"># Forward pass through the second-order network with inputs from the first-order network</span>
            <span class="n">output_second_order</span> <span class="o">=</span> <span class="n">second_order_network</span><span class="p">(</span><span class="n">patterns_tensor</span><span class="p">,</span> <span class="n">output_first_order</span><span class="p">)</span>

            <span class="c1"># Calculate the loss for the second-order network (wagering decision based on comparison)</span>
            <span class="n">loss_2</span> <span class="o">=</span> <span class="n">criterion_2</span><span class="p">(</span><span class="n">output_second_order</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">order_2_tensor</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

            <span class="n">optimizer_2</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>


            <span class="c1"># Backpropagate the second-order network's loss</span>
            <span class="n">loss_2</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">retain_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Allows further backpropagation for loss_1 after loss_2</span>

            <span class="c1"># Update second-order network weights</span>
            <span class="n">optimizer_2</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

            <span class="n">scheduler_2</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

            <span class="n">epoch_2_order</span><span class="p">[</span><span class="n">epoch</span><span class="p">]</span> <span class="o">=</span> <span class="n">loss_2</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Skip computations for the second-order network</span>
            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="c1"># Potentially forward pass through the second-order network without tracking gradients</span>
                <span class="n">output_second_order</span> <span class="o">=</span> <span class="n">second_order_network</span><span class="p">(</span><span class="n">patterns_tensor</span><span class="p">,</span> <span class="n">output_first_order</span><span class="p">)</span>

        <span class="c1"># Calculate the loss for the first-order network (accuracy of stimulus representation)</span>

        <span class="n">num_args</span> <span class="o">=</span> <span class="n">get_num_args</span><span class="p">(</span><span class="n">criterion_1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">num_args</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
          <span class="n">loss_1</span> <span class="o">=</span> <span class="n">criterion_1</span><span class="p">(</span>  <span class="n">output_first_order</span> <span class="p">,</span> <span class="n">stim_present_tensor</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">W</span> <span class="o">=</span> <span class="n">first_order_network</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()[</span><span class="s1">'fc1.weight'</span><span class="p">]</span>
          <span class="n">loss_1</span> <span class="o">=</span> <span class="n">criterion_1</span><span class="p">(</span> <span class="n">W</span><span class="p">,</span> <span class="n">stim_present_tensor</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">output_first_order</span><span class="p">,</span>
                             <span class="n">hidden_representation</span><span class="p">,</span> <span class="n">lam</span> <span class="p">)</span>

        <span class="c1"># Backpropagate the first-order network's loss</span>
        <span class="n">loss_1</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

        <span class="c1"># Update first-order network weights</span>
        <span class="n">optimizer_1</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="c1"># Reset first-order optimizer gradients to zero for the next iteration</span>

        <span class="c1"># Update the first-order scheduler</span>
        <span class="n">scheduler_1</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="n">epoch_1_order</span><span class="p">[</span><span class="n">epoch</span><span class="p">]</span> <span class="o">=</span> <span class="n">loss_1</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="c1">#epoch_1_order[epoch] = loss_location.item()</span>

    <span class="k">return</span> <span class="n">first_order_network</span><span class="p">,</span> <span class="n">second_order_network</span><span class="p">,</span> <span class="n">epoch_1_order</span><span class="p">,</span> <span class="n">epoch_2_order</span> <span class="p">,</span> <span class="p">(</span><span class="n">max_values_output_first_order</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">max_indices_output_first_order</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">max_values_patterns_tensor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">max_indices_patterns_tensor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Define the architecture, optimizers, loss functions, and schedulers for pre training</span>
<span class="n">seeds</span><span class="o">=</span><span class="mi">15</span>

<span class="n">results_seed</span><span class="o">=</span><span class="p">[]</span>
<span class="n">discrimination_seed</span><span class="o">=</span><span class="p">[]</span>

<span class="c1"># Hyperparameters</span>
<span class="n">optimizer</span><span class="o">=</span><span class="s2">"ADAMAX"</span>
<span class="n">hidden</span><span class="o">=</span><span class="mi">40</span>
<span class="n">factor</span><span class="o">=</span><span class="mi">2</span>
<span class="n">gelu</span><span class="o">=</span><span class="kc">False</span>
<span class="n">gam</span><span class="o">=</span><span class="mf">0.98</span>
<span class="n">meta</span><span class="o">=</span><span class="kc">True</span>
<span class="n">stepsize</span><span class="o">=</span><span class="mi">25</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">seeds</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Seed </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

  <span class="c1"># Compare your results with the patterns generate below</span>
  <span class="n">initialize_global</span><span class="p">()</span>

  <span class="c1"># Prepare networks, loss functions, optimizers, and schedulers for pre-training</span>
  <span class="n">first_order_network</span><span class="p">,</span> <span class="n">second_order_network</span><span class="p">,</span> <span class="n">criterion_1</span><span class="p">,</span> <span class="n">criterion_2</span><span class="p">,</span> <span class="n">optimizer_1</span><span class="p">,</span> <span class="n">optimizer_2</span><span class="p">,</span> <span class="n">scheduler_1</span><span class="p">,</span> <span class="n">scheduler_2</span> <span class="o">=</span> <span class="n">prepare_pre_training</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">gelu</span><span class="p">,</span> <span class="n">stepsize</span><span class="p">,</span> <span class="n">gam</span><span class="p">)</span>

  <span class="c1"># Conduct pre-training for both the first-order and second-order networks</span>
  <span class="n">first_order_network_pre</span><span class="p">,</span> <span class="n">second_order_network_pre</span><span class="p">,</span> <span class="n">epoch_1_order</span><span class="p">,</span> <span class="n">epoch_2_order</span> <span class="p">,</span> <span class="n">max_value_indices</span> <span class="o">=</span> <span class="n">pre_train</span><span class="p">(</span><span class="n">first_order_network</span><span class="p">,</span> <span class="n">second_order_network</span><span class="p">,</span> <span class="n">criterion_1</span><span class="p">,</span>  <span class="n">criterion_2</span><span class="p">,</span> <span class="n">optimizer_1</span><span class="p">,</span> <span class="n">optimizer_2</span><span class="p">,</span> <span class="n">scheduler_1</span><span class="p">,</span> <span class="n">scheduler_2</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span>

  <span class="c1"># Plot the training progress of both networks to visualize performance and learning trends</span>
  <span class="n">pre_train_plots</span><span class="p">(</span><span class="n">epoch_1_order</span><span class="p">,</span> <span class="n">epoch_2_order</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"1st &amp; 2nd Order Networks - Seed </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span> <span class="p">,</span> <span class="n">max_value_indices</span> <span class="p">)</span>

  <span class="c1"># Configuration step for the main training phase or evaluation</span>
  <span class="n">testing_patterns</span><span class="p">,</span> <span class="n">n_samples</span> <span class="o">=</span> <span class="n">get_test_patterns</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>

  <span class="c1"># Function to test the model using the configured testing patterns</span>
  <span class="n">first_order_network_pre</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
  <span class="n">second_order_network_pre</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
  <span class="n">f1_scores_wager</span><span class="p">,</span> <span class="n">mse_losses_indices</span> <span class="p">,</span> <span class="n">mse_losses_values</span> <span class="p">,</span> <span class="n">discrimination_performances</span><span class="p">,</span> <span class="n">results_for_plotting</span> <span class="o">=</span> <span class="n">testing</span><span class="p">(</span><span class="n">testing_patterns</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">first_order_network_pre</span><span class="p">,</span> <span class="n">second_order_network_pre</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>
  <span class="n">results_seed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results_for_plotting</span><span class="p">)</span>
  <span class="n">discrimination_seed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">discrimination_performances</span><span class="p">)</span>

<span class="n">plot_testing</span><span class="p">(</span><span class="n">results_seed</span><span class="p">,</span> <span class="n">discrimination_seed</span><span class="p">,</span> <span class="n">seeds</span><span class="p">,</span> <span class="s2">"Test Results"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id9">
<h3>Discussion point<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h3>
<p>Let’s dive into the outcomes!</p>
<ul class="simple">
<li><p>Did you notice any variations between the two models?</p></li>
<li><p>Can you explain how these differences influenced the performance?</p></li>
<li><p>What role does a second-order network play, and in which situations would it be more effective?</p></li>
</ul>
<section id="id10">
<h4>Submit your feedback<a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Discussion_Point_Second_Order_Network"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="video-6-second-order-network">
<h4>Video 6: Second Order Network<a class="headerlink" href="#video-6-second-order-network" title="Permalink to this heading">#</a></h4>
<div class="cell tag_remove-input docutils container">
</div>
</section>
<section id="id11">
<h4>Submit your feedback<a class="headerlink" href="#id11" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Video_6"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
</section>
<section id="higher-order-state-space-hoss-model">
<h2>Higher Order State Space (HOSS) model<a class="headerlink" href="#higher-order-state-space-hoss-model" title="Permalink to this heading">#</a></h2>
<p>Next, Steve is going to tell us about the higher order state space model of consciousness, including the computational and neurological underpinnings that differentiate conscious from unconscious perception.</p>
<section id="video-7-higher-order-state-spaces">
<h3>Video 7: Higher-Order State Spaces<a class="headerlink" href="#video-7-higher-order-state-spaces" title="Permalink to this heading">#</a></h3>
<div class="cell tag_remove-input docutils container">
</div>
</section>
<section id="id12">
<h3>Submit your feedback<a class="headerlink" href="#id12" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Video_7"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>In this section, we’ll merge ideas from earlier discussions to present a fresh perspective on how conscious awareness might arise in neural systems. This view comes from higher-order theory, which suggests that consciousness stems from the ability to monitor basic, or first-order, information processing activities, instead of merely broadcasting information globally. This concept agrees with global workspace theories that emphasize the need for a comprehensive monitor that oversees various first-order processes. Moreover, it extends the ideas discussed previously about the role of a second-order network, which helps us understand phenomena like blindsight, where a person can respond to visual stimuli without consciously seeing them.</p>
<p>To analyze how our brains handle and update perceptions, we’ll operate within a simplified Bayesian framework. This framework helps us evaluate how we perceive reality based on the information we receive. For example, if you hear rustling leaves, your brain calculates the likelihood of it being caused by the wind versus an animal. This calculation involves updating what we initially guess (our prior belief) with new evidence (observed data), resulting in a new, more informed belief (posterior probability).</p>
<p>The function below calculates these updated beliefs and uses Kullback-Leibler (KL) divergence to quantify how much the new information changes our understanding. The KL divergence is a way of measuring the ‘distance’ between the initial belief and your updated belief. In essence, it’s measuring how much you have to change your mind given new evidence.</p>
<p>We base our analysis on a flat, or single-layer, Bayesian network model. This model directly connects our sensory inputs with our perceptual states, simplifying the complex interactions in our brain into a more manageable form. By stripping away the complexities of multi-layered networks, we focus purely on how direct observations impact our consciousness. This simplified approach helps us to better understand the intricate dance between perception and awareness in our neural systems.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">HOSS_evaluate_flat</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">Wprior</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Perform inference on a 2D Bayes net for asymmetric inference on presence vs. absence.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    X - Observed data</span>
<span class="sd">    mu - Means for each perceptual state</span>
<span class="sd">    Sigma - Covariance matrix</span>
<span class="sd">    Wprior - Prior probabilities of perceptual states</span>

<span class="sd">    #Returns:</span>
<span class="sd">    post_W - Posterior probabilities of perceptual states</span>
<span class="sd">    KL_W - Kullback-Leibler divergence from posterior to prior</span>
<span class="sd">    """</span>
    <span class="c1"># Prior on perceptual states W</span>
    <span class="n">p_W</span> <span class="o">=</span> <span class="n">Wprior</span>

    <span class="c1"># Compute likelihood of observed X for each possible W (P(X|W))</span>
    <span class="n">log_lik_X_W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">multivariate_normal</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="n">mu</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">cov</span><span class="o">=</span><span class="n">Sigma</span><span class="p">))</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>

    <span class="c1"># Renormalize to get P(X|W)</span>
    <span class="n">log_p_X_W</span> <span class="o">=</span> <span class="n">log_lik_X_W</span> <span class="o">-</span> <span class="n">logsumexp</span><span class="p">(</span><span class="n">log_lik_X_W</span><span class="p">)</span>

    <span class="c1"># Posterior over W (P(W|X=x))</span>
    <span class="n">log_post_W</span> <span class="o">=</span> <span class="n">log_p_X_W</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p_W</span><span class="p">)</span>
    <span class="n">log_post_W</span> <span class="o">=</span> <span class="n">log_post_W</span> <span class="o">-</span> <span class="n">logsumexp</span><span class="p">(</span><span class="n">log_post_W</span><span class="p">)</span>  <span class="c1"># Normalize</span>
    <span class="n">post_W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_post_W</span><span class="p">)</span>

    <span class="c1"># KL divergences</span>
    <span class="n">KL_W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">post_W</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">post_W</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p_W</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">post_W</span><span class="p">,</span> <span class="n">KL_W</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Make our stimulus space</strong></p>
<p>The model we are using is grounded in classical “signal detection theory”, or SDT for short. SDT is in turn a special case of a Bayesian generative model, in which an arbitrary “evidence” value is drawn from an unknown distribution, and the task of the observer is to infer which distribution this evidence came from.</p>
<p>In SDT, an observer receives a piece of evidence—this could be any sensory input, like a sound, a light signal, or a statistical data point. The evidence comes from one of several potential distributions. Each distribution represents a different “state of the world.” For instance, one distribution might represent the presence of a signal (like a beep), while another might represent just noise. The observer uses Bayesian inference to assess the probability that the received evidence came from one distribution or another. This involves updating their beliefs (probabilities) based on the new evidence. Based on the probabilities calculated through Bayesian inference, the observer decides which distribution most likely produced the evidence.</p>
<p>Let’s now imagine we have two categories, A and B - for instance, left- and right-tilted visual stimuli. The sensory “evidence” can be written as 2D vector, where the first element is evidence for A, and the second element evidence for B:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creating the array X with strong evidence for A and weak evidence for B</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>The origin (0,0) represents low activation of both features, consistent with no stimulus (or noise) being presented. Comparing how the model handles inference on stimulus presence vs. absence - detecting, vs. not detecting a stimulus - allows us to capture the classical conscious vs. unconscious contrast in consciousness science.</p>
<p>Let’s start by creating our space, and placing three Gaussian distributions on the space that represent the likelihood of observing a pair of features given each of three stimulus classes:</p>
<ul class="simple">
<li><p>leftward tilt (<span class="math notranslate nohighlight">\(w_1\)</span>)</p></li>
<li><p>rightward tilt (<span class="math notranslate nohighlight">\(w_2\)</span>)</p></li>
<li><p>noise/nothing (<span class="math notranslate nohighlight">\(w_0\)</span>)</p></li>
</ul>
<p>By setting up this model, we aim to simulate and analyze how an observer infers the presence or absence of a stimulus. When the observer detects a stimulus, the inference process would lean towards either the leftward or rightward tilt, depending on which Gaussian (<span class="math notranslate nohighlight">\(w_1\)</span> or <span class="math notranslate nohighlight">\(w_2\)</span>) the observed data points are closer to in feature space. When the observer fails to detect a stimulus, the inference process would recognize that the data points fall closer to the noise distribution centered at the origin.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the grid</span>
<span class="n">xgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mf">6.02</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
<span class="n">X1</span><span class="p">,</span> <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">)</span>

<span class="c1"># Mean and covariance of the distributions</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">]])</span>
<span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

<span class="c1"># Plotting</span>
<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">():</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

    <span class="c1"># Colors and labels according to the specification</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'green'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'no stimulus'</span><span class="p">,</span> <span class="s1">'left tilt'</span><span class="p">,</span> <span class="s1">'right tilt'</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">labels</span><span class="p">)):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">multivariate_normal</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">)),</span> <span class="n">mean</span><span class="o">=</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cov</span><span class="o">=</span><span class="n">Sigma</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Create custom legends</span>
    <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">labels</span><span class="p">)]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_elements</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">)</span>

    <span class="c1"># Reverse the X1 axis</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'evidence for left tilt'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'evidence for right tilt'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'2D SDT'</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s measure the evidence for each of the three classes at each point in the space. We’ll then use this evidence to calculate the posterior probability of each class given the evidence. This calculation will help us understand how the observer’s beliefs change based on the sensory data they receive.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span>
<span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
<span class="n">Xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">left</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">right</span><span class="o">.</span><span class="n">ravel</span><span class="p">()],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Define the input parameters</span>

<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">]])</span>
<span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">Wprior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># flat priors</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s1">'green'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">])</span>

<span class="c1"># Under this configuration, the posterior probabilities and KL divergences are calculated</span>
<span class="n">most_likely_class</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">KL_Ws</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Xs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">post_w</span><span class="p">,</span> <span class="n">KL_W</span> <span class="o">=</span> <span class="n">HOSS_evaluate_flat</span><span class="p">(</span><span class="n">Xs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mu</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">Wprior</span><span class="p">)</span>
    <span class="n">most_likely_class</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">post_w</span><span class="p">))</span>
    <span class="n">KL_Ws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">KL_W</span><span class="p">)</span>

<span class="n">most_likely_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">most_likely_class</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">KL_Ws</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">KL_Ws</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">():</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s1">'compressed'</span><span class="p">)</span>

    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">most_likely_class</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Most likely class"</span><span class="p">)</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">'none'</span><span class="p">,</span> <span class="s1">'left'</span><span class="p">,</span> <span class="s1">'right'</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'left tilt evidence'</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'right tilt evidence'</span><span class="p">)</span>

    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">KL_Ws</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"KL divergence"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'left tilt evidence'</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'right tilt evidence'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The model partitions the stimuli in the expected way. KL divergence is higher further away from the boundaries, as measuring stimuli far away from the boundaries makes the model rapidly update its beliefs. This is because the model is more certain about the stimuli’s class when they are far from the boundaries.</p>
<p><strong>Add in higher-order node for global detection</strong></p>
<p>So far, our model has been straightforward, or “flat,” where each perceptual state (like leftward tilt, rightward tilt, or no stimulus) is treated separately. However, real-life perception often requires more complex judgments about the presence or absence of any stimulus, not just identifying specific types. This is where a higher-order node comes into play.</p>
<p><strong>Introducing the “A” Level:</strong></p>
<p>Think of the “A” level as a kind of overseer or monitor that watches over the lower-level states (<span class="math notranslate nohighlight">\(w_1\)</span>, <span class="math notranslate nohighlight">\(w_2\)</span>, etc.). This higher-order node isn’t concerned with the specific content of the stimulus (like which direction something is tilting) but rather with whether there’s any significant stimulus at all versus just noise. It takes inputs from the same data (pairs of <span class="math notranslate nohighlight">\(X\)</span>’s), but it adds a layer of awareness. It evaluates whether the data points suggest any meaningful content or if they’re likely just random noise.</p>
<p>The system can now answer questions on two levels:</p>
<ul class="simple">
<li><p>the content level (W-level)</p></li>
<li><p>the awareness or presence of any content (A-level)</p></li>
</ul>
<p>The output from the A-level, denoted as <code class="docutils literal notranslate"><span class="pre">post_A</span></code>, represents the posterior probability that there is any relevant content as opposed to mere noise. To make this work, we also need to set priors (initial guesses before seeing the data) at both the W-level (content) and A-level (awareness). This helps the model start with a baseline expectation about the likelihood of encountering various stimuli or noise.</p>
<p>In the next sections, we will illustrate the operation of a higher-order state space (HOSS) for monitoring first-order information processing. This model, with its higher-order node, mimics human perceptual processing where not every sensory input leads to awareness.</p>
<p><img alt="Picture about the HOSS model." src="https://github.com/neuromatch/NeuroAI_Course/blob/main/tutorials/W2D5_Mysteries/static/HOSS.png?raw=true"/></p>
</section>
<section id="model-inference">
<h3>Model inference<a class="headerlink" href="#model-inference" title="Permalink to this heading">#</a></h3>
<p>We denote an observation <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> as a pair of features <span class="math notranslate nohighlight">\((X_1, X_2)\)</span>, where <span class="math notranslate nohighlight">\(X_1\)</span> and <span class="math notranslate nohighlight">\(X_2\)</span> are the evidence for the presence of two different stimuli. The observer’s task is to infer which of three possible stimuli <span class="math notranslate nohighlight">\(W \in [w_0, w_1, w_2]\)</span> generated the observation. Each stimulus <span class="math notranslate nohighlight">\(W\)</span> is associated with a Gaussian distribution in the feature space:</p>
<div class="math notranslate nohighlight">
\[p(X=\mathbf{x}|W) = \mathcal{N}(\mathbf{\mu_W}, \mathbf{\Sigma})\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{\mu_W}\)</span> is the mean of each Gaussian, and <span class="math notranslate nohighlight">\(\mathbf{\Sigma}\)</span> is the covariance matrix.</p>
<p>At a higher level, the observer also needs to infer the presence of any stimulus, regardless of its specific type. This is done by calculating the posterior probability of the awareness state <span class="math notranslate nohighlight">\(A\)</span> given the observation:</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned}
P(A|X=x) &amp;\propto \sum_{W} P(A)P(W|A)P(X=x|W) \
&amp; \propto P(A)\sum_{W} P(W|A)P(X=x|W)
\end{aligned}
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(A\)</span> is the awareness state, a two-dimensional binary variable, with <span class="math notranslate nohighlight">\(A_0\)</span> representing no stimulus and <span class="math notranslate nohighlight">\(A_1\)</span> representing the presence of a stimulus</p></li>
<li><p><span class="math notranslate nohighlight">\(P(A)\)</span> is the prior probability of each awareness state</p></li>
<li><p><span class="math notranslate nohighlight">\(P(W|A)\)</span> is the likelihood of each world state given the awareness state. This is 0 for the no stimulus state and <span class="math notranslate nohighlight">\(p(W)\)</span> for the stimulus present states.</p></li>
<li><p><span class="math notranslate nohighlight">\(P(X=x|W)\)</span> is the likelihood of the observation given each world state.</p></li>
</ul>
<p>Finally, the observer can calculate the posterior probability of each stimulus class given the observation and the awareness state:</p>
<div class="math notranslate nohighlight">
\[
P(W|X=x) \propto \sum_{A} P(A)P(W|A)P(X=x|W)
\]</div>
<p>With these equations, we’re ready to simulate the observer’s inference process and explore how the model behaves under different conditions.</p>
</section>
<section id="coding-exercise">
<h3>Coding exercise<a class="headerlink" href="#coding-exercise" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">HOSS_evaluate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">Aprior</span><span class="p">,</span> <span class="n">Wprior</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>

<span class="sd">    Inference on 2D Bayes net for asymmetric inference on presence vs. absence.</span>
<span class="sd">    """</span>

    <span class="c1">#################################################</span>
    <span class="c1">## TODO for students: fill in the missing variables ##</span>
    <span class="c1"># Fill out function and remove</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Student exercise: fill in the missing variables"</span><span class="p">)</span>
    <span class="c1">#################################################</span>

    <span class="c1"># Initialise variables and conditional prob tables</span>
    <span class="n">p_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Aprior</span><span class="p">,</span> <span class="n">Aprior</span><span class="p">])</span>  <span class="c1"># prior on awareness state A</span>
    <span class="n">p_W_a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Wprior</span><span class="p">)</span>  <span class="c1"># likelihood of world states W given aware, first entry is absence</span>
    <span class="n">p_W_a0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Wprior</span><span class="p">)))</span>  <span class="c1"># likelihood of world states W given unaware, first entry is absence</span>
    <span class="n">p_W</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_W_a1</span> <span class="o">+</span> <span class="n">p_W_a0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># prior on W marginalising over A (for KL)</span>

    <span class="c1"># Compute likelihood of observed X for each possible W (P(X|mu_w, Sigma))</span>
    <span class="n">lik_X_W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">multivariate_normal</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="n">mu_i</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="n">Sigma</span><span class="p">)</span> <span class="k">for</span> <span class="n">mu_i</span> <span class="ow">in</span> <span class="n">mu</span><span class="p">])</span>
    <span class="n">p_X_W</span> <span class="o">=</span> <span class="n">lik_X_W</span> <span class="o">/</span> <span class="n">lik_X_W</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># normalise to get P(X|W)</span>

    <span class="c1"># Combine with likelihood of each world state w given awareness state A</span>
    <span class="n">lik_W_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">p_X_W</span> <span class="o">*</span> <span class="n">p_W_a0</span> <span class="o">*</span> <span class="n">p_A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_X_W</span> <span class="o">*</span> <span class="n">p_W_a1</span> <span class="o">*</span> <span class="n">p_A</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">post_A</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># sum over W</span>
    <span class="n">post_A</span> <span class="o">=</span> <span class="n">post_A</span> <span class="o">/</span> <span class="n">post_A</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># normalise</span>

    <span class="c1"># Posterior over W (P(W|X=x) marginalising over A)</span>
    <span class="n">post_W</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># sum over A</span>
    <span class="n">post_W</span> <span class="o">=</span> <span class="n">post_W</span> <span class="o">/</span> <span class="n">post_W</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># normalise</span>

    <span class="c1"># KL divergences</span>
    <span class="n">KL_W</span> <span class="o">=</span> <span class="p">(</span><span class="n">post_W</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">post_W</span> <span class="o">/</span> <span class="n">p_W</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">KL_A</span> <span class="o">=</span> <span class="p">(</span><span class="n">post_A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">post_A</span> <span class="o">/</span> <span class="n">p_A</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">post_W</span><span class="p">,</span> <span class="n">post_A</span><span class="p">,</span> <span class="n">KL_W</span><span class="p">,</span> <span class="n">KL_A</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/neuromatch/NeuroAI_Course/tree/main/tutorials/W2D5_Mysteries/solutions/W2D5_Tutorial1_Solution_20a869fc.py"><em>Click for solution</em></a></p>
<section id="id13">
<h4>Submit your feedback<a class="headerlink" href="#id13" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Hoss"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Now that we’ve coded our multi-level model, we’re ready to evaluate it! We first set the prior on presence (vs. absence), and then set the priors on <span class="math notranslate nohighlight">\(w_1\)</span> vs. <span class="math notranslate nohighlight">\(w_2\)</span>, and the model takes care of the rest.</p>
<p>We’ll evaluate the model on the edge between the leftward stimulus <span class="math notranslate nohighlight">\(w_1\)</span> and the absence of a stimulus <span class="math notranslate nohighlight">\(w_0\)</span>. This edge case is particularly interesting because it’s where the model is most uncertain about the presence of a stimulus.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the input parameters for this specific example</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>  <span class="c1"># Input observed features</span>
<span class="n">Wprior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>  <span class="c1"># Prior probabilities of stimuli</span>
<span class="n">Aprior</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Prior probability of being aware</span>

<span class="c1"># Call the HOSS_evaluate function with the specified parameters</span>
<span class="n">post_W</span><span class="p">,</span> <span class="n">post_A</span><span class="p">,</span> <span class="n">KL_W</span><span class="p">,</span> <span class="n">KL_A</span> <span class="o">=</span> <span class="n">HOSS_evaluate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">Aprior</span><span class="p">,</span> <span class="n">Wprior</span><span class="p">)</span>

<span class="c1"># Print the posterior probabilities</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Posterior probabilities at W level: </span><span class="si">{</span><span class="n">post_W</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Posterior probability at awareness at A level: </span><span class="si">{</span><span class="n">post_A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We notice two things:</p>
<ul class="simple">
<li><p>The model is fairly certain that the stimulus is absent; the probability of awareness
is &lt; 0.5.</p></li>
<li><p>The model nevertheless assigns much higher probability to the presence of the leftward stimulus <span class="math notranslate nohighlight">\(w_1\)</span> than to the rightward stimulus <span class="math notranslate nohighlight">\(w_2\)</span>.</p></li>
</ul>
<p>This captures the essence of a phenomenon like blindsight: there can be positive discrimination between different stimuli even when the observer is not consciously aware of the stimulus. Let’s look at how the awareness signal changes as the evidence changes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span>
<span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
<span class="n">Xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">left</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">right</span><span class="o">.</span><span class="n">ravel</span><span class="p">()],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Define the input parameters</span>

<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">]])</span>
<span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">Wprior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">])</span>  <span class="c1"># flat priors</span>

<span class="c1"># Under this configuration, the posterior probabilities and KL divergences are calculated</span>
<span class="n">rightwards</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">awareness</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Xs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">post_W</span><span class="p">,</span> <span class="n">post_A</span><span class="p">,</span> <span class="n">KL_W</span><span class="p">,</span> <span class="n">KL_A</span> <span class="o">=</span> <span class="n">HOSS_evaluate</span><span class="p">(</span><span class="n">Xs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">mu</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">Aprior</span><span class="p">,</span> <span class="n">Wprior</span><span class="p">)</span>
    <span class="n">rightwards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post_W</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">post_W</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">post_W</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">awareness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post_A</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">rightwards</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rightwards</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">awareness</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">awareness</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">():</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s1">'compressed'</span><span class="p">)</span>


    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">awareness</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"P(awareness)"</span><span class="p">)</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'left tilt evidence'</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'right tilt evidence'</span><span class="p">)</span>

    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rightwards</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"P(rightwards)"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'left tilt evidence'</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'right tilt evidence'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that in the bottom left, the probability of awareness is low, even as the evidence for leftward or rightward tilt can be high.</p>
<p><strong>Simulate ignition (asymmetry vs. symmetry)</strong></p>
<p>The HOSS architecture is designed to detect whether something is there or not. When it detects something, it ends up making more prediction errors in its predictions compared to when it detects nothing. These prediction errors are tracked using a method called Kullback-Leibler (KL) divergence, particularly at a certain level within the model known as the W level.</p>
<p>This increase in prediction errors when something is detected is similar to what happens in the human brain, a phenomenon known as global ignition responses. These are big surges in brain activity that happen when we become conscious of something. Research like that conducted by Del Cul et al. (2007) and Dehaene and Changeux (2011) support this concept, linking it to the global workspace model. This model describes consciousness as the sharing of information across different parts of the brain.</p>
<p>In our model, we simulate this by adjusting the intensity of the stimulus and observing how the prediction errors vary in the model. Under a theory called predictive coding, which describes how the brain processes information, KL divergence acts like a marker for neural activity, making it a good stand-in for studying brain-like responses.</p>
<p>We then classify these prediction errors based on whether the model recognizes a stimulus as “seen” or “unseen.” If the model has a response indicating “seen,” it shows more activity than when it indicates “unseen.” This is what we refer to as ignition — more activity for “seen” stimuli.</p>
<p>However, it’s crucial to understand that in the HOSS model, these ignition-like responses don’t directly cause the global sharing of information in the network. Rather, they are secondary effects or byproducts of other calculations happening within the network. Essentially, these bursts of activity are outcomes of deeper processes in the network, not the direct mechanisms for distributing information throughout the system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Experiment parameters</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">]])</span>
<span class="n">Nsubjects</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">Ntrials</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Ntrials</span><span class="o">//</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Ntrials</span><span class="o">//</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Ntrials</span><span class="o">//</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">))</span>
<span class="n">Wprior</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="n">Aprior</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># Sensory precision values</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="c1"># Initialize lists for results</span>
<span class="n">all_KL_w_yes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sem_KL_w_yes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">all_KL_w_no</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sem_KL_w_no</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">all_KL_A_yes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sem_KL_A_yes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">all_KL_A_no</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sem_KL_A_no</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">all_prob_y</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1">##############################################################################</span>
<span class="c1">## TODO for students: Fill in the missing parts (...)</span>
<span class="c1">## Fill in the missing parts to complete the function and remove</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Student exercise"</span><span class="p">)</span>
<span class="c1">##############################################################################</span>

<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">'Processing gammas'</span><span class="p">):</span>
    <span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">mean_KL_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nsubjects</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">mean_KL_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nsubjects</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">prob_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nsubjects</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Nsubjects</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s1">'Subjects for gamma=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">KL_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cond</span><span class="p">))</span>
        <span class="n">KL_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cond</span><span class="p">))</span>
        <span class="n">posteriorAware</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cond</span><span class="p">))</span>

        <span class="c1"># Generate sensory samples</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">multivariate_normal</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="n">mu</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">cov</span><span class="o">=</span><span class="n">Sigma</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cond</span><span class="p">])</span>

        <span class="c1"># Model inversion for each trial</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
            <span class="n">post_w</span><span class="p">,</span> <span class="n">post_A</span><span class="p">,</span> <span class="n">KL_w</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">KL_A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">HOSS_evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">Aprior</span><span class="p">,</span> <span class="n">Wprior</span><span class="p">)</span>
            <span class="n">posteriorAware</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">post_A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Assuming post_A is a tuple with awareness probability at index 1</span>

        <span class="n">binaryAware</span> <span class="o">=</span> <span class="n">posteriorAware</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">conditions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">cond</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">cond</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">cond</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">cond</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">aware_conditions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">binaryAware</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">binaryAware</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">binaryAware</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">binaryAware</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">mean_KL_w</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">KL_w</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">aware_conditions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conditions</span><span class="p">[</span><span class="n">i</span><span class="p">])])</span>
            <span class="n">mean_KL_A</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">KL_A</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">aware_conditions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">conditions</span><span class="p">[</span><span class="n">i</span><span class="p">])])</span>

        <span class="n">prob_y</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">binaryAware</span><span class="p">[</span><span class="n">cond</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Aggregate results across subjects</span>
    <span class="n">all_KL_w_yes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">mean_KL_w</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
    <span class="n">sem_KL_w_yes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">mean_KL_w</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Nsubjects</span><span class="p">))</span>
    <span class="n">all_KL_w_no</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">mean_KL_w</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
    <span class="n">sem_KL_w_no</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">mean_KL_w</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Nsubjects</span><span class="p">))</span>
    <span class="n">all_KL_A_yes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">mean_KL_A</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
    <span class="n">sem_KL_A_yes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">mean_KL_A</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Nsubjects</span><span class="p">))</span>
    <span class="n">all_KL_A_no</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">mean_KL_A</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
    <span class="n">sem_KL_A_no</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">mean_KL_A</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Nsubjects</span><span class="p">))</span>
    <span class="n">all_prob_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">prob_y</span><span class="p">))</span>

<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">():</span>

    <span class="c1"># Create figure</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># First subplot: Probability of reporting "seen" for w_1 or w_2</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">all_prob_y</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Stimulus strength'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Prob. report "seen" for w_1 or w_2'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Second subplot: K-L divergence, perceptual states</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">all_KL_w_yes</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sem_KL_w_yes</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Seen'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">all_KL_w_no</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sem_KL_w_no</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Unseen'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Stimulus strength'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'KL-divergence, perceptual states'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Third subplot: K-L divergence, awareness state</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">all_KL_A_yes</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sem_KL_A_yes</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Seen'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">all_KL_A_no</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sem_KL_A_no</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Unseen'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Stimulus strength'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'KL-divergence, awareness state'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Adjust layout and display the figure</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/neuromatch/NeuroAI_Course/tree/main/tutorials/W2D5_Mysteries/solutions/W2D5_Tutorial1_Solution_96fe639d.py"><em>Click for solution</em></a></p>
<p><em>Example output:</em></p>
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/neuromatch/NeuroAI_Course/main/tutorials/W2D5_Mysteries/static/W2D5_Tutorial1_Solution_96fe639d_585.png"><img align="center" alt="Solution hint" class="align-center" src="https://raw.githubusercontent.com/neuromatch/NeuroAI_Course/main/tutorials/W2D5_Mysteries/static/W2D5_Tutorial1_Solution_96fe639d_585.png" style="width: 977.0px; height: 477.0px;"/></a>
</section>
<section id="id14">
<h4>Submit your feedback<a class="headerlink" href="#id14" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Ignition"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="id15">
<h3>Discussion point<a class="headerlink" href="#id15" title="Permalink to this heading">#</a></h3>
<p>What do you think is the main takeaway on the distinction between the Global Workspace model and the HOSS on ignition?</p>
<p><a class="reference external" href="https://github.com/neuromatch/NeuroAI_Course/tree/main/tutorials/W2D5_Mysteries/solutions/W2D5_Tutorial1_Solution_bfd5f466.py"><em>Click for solution</em></a></p>
<p>Now, Steve will give us a brief recap about how the greater prediction error in seen trials reveals the asymmetry in model architecture and its impact on understanding neural signatures of consciousness, contrasting the classical global workspace view with the higher order state view.</p>
<section id="id16">
<h4>Submit your feedback<a class="headerlink" href="#id16" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Discussion_Point_HOSS"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="video-8-outro-ignition">
<h4>Video 8: Outro - Ignition<a class="headerlink" href="#video-8-outro-ignition" title="Permalink to this heading">#</a></h4>
<div class="cell tag_remove-input docutils container">
</div>
</section>
<section id="id17">
<h4>Submit your feedback<a class="headerlink" href="#id17" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Video_8"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
</section>
</section>
<hr class="docutils"/>
<section class="tex2jax_ignore mathjax_ignore" id="summary">
<h1>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h1>
<p>Hakwan will now discuss the critical aspects and limitations of current consciousness studies, addressing the challenges in distinguishing theories of consciousness from those merely describing general brain functions.</p>
<section id="video-9-final-thoughts">
<h2>Video 9: Final Thoughts<a class="headerlink" href="#video-9-final-thoughts" title="Permalink to this heading">#</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
</section>
<section id="id18">
<h2>Submit your feedback<a class="headerlink" href="#id18" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Video_9"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Congrats! You’ve made it to the end of this tutorial. Let’s wrap up.</p>
</section>
<section id="video-10-final-thoughts">
<h2>Video 10: Final Thoughts<a class="headerlink" href="#video-10-final-thoughts" title="Permalink to this heading">#</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
</section>
<section id="id19">
<h2>Submit your feedback<a class="headerlink" href="#id19" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Video_10"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Below you’ll find some optional coding &amp; discussion bonus content!</p>
</section>
</section>
<hr class="docutils"/>
<section class="tex2jax_ignore mathjax_ignore" id="coding-bonus-section">
<h1>Coding Bonus Section<a class="headerlink" href="#coding-bonus-section" title="Permalink to this heading">#</a></h1>
<p>This secton contains some extra coding exercises in case you have time and inclination.</p>
<section id="bonus-coding-exersice-1-train-a-first-order-network">
<h2>Bonus coding exersice 1: Train a first-order network<a class="headerlink" href="#bonus-coding-exersice-1-train-a-first-order-network" title="Permalink to this heading">#</a></h2>
<p>This section invites you to engage with a straightforward, auto-generated dataset on blindsight, originally introduced by <a class="reference external" href="https://www.sciencedirect.com/science/article/abs/pii/S0010027710001794">Pasquali et al. in 2010</a>. Blindsight is a fascinating condition where individuals who are cortically blind due to damage in their primary visual cortex can still respond to visual stimuli without conscious perception. This intriguing phenomenon underscores the intricate nature of sensory processing and the brain’s ability to process information without conscious awareness.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize the autogenerated data</span>
<span class="n">factor</span><span class="o">=</span><span class="mi">2</span>
<span class="n">initialize_global</span><span class="p">()</span>
<span class="n">set_pre</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_patterns</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>
<span class="n">plot_signal_max_and_indicator</span><span class="p">(</span><span class="n">set_pre</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="s2">"Example - Pre training dataset"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The pre-training dataset for the network consisted of 200 patterns. These were evenly divided: half were purely noise (with unit activations randomly chosen between 0.0 and 0.02), and the other half represented potential stimuli. In the stimulus patterns, 99 out of 100 units had activations ranging between 0.0 and 0.02, with one unique unit having an activation between 0.0 and 1.0.</p>
<p><strong>Testing patterns</strong></p>
<p>As we have seen before, the network underwent evaluations under three distinct conditions, each modifying the signal-to-noise ratio in a unique way to explore different degrees and types of blindness.</p>
<p>Suprathreshold stimulus condition: here, the network was exposed to the identical set of 200 patterns used during pre-training, testing the network’s response to familiar inputs.</p>
<p>Subthreshold stimulus condition (blindsight simulation): this condition aimed to mimic blindsight. It was achieved by introducing a slight noise increment (+0.0012) to every input of the first-order network, barring the one designated as the stimulus. This setup tested the network’s ability to discern faint signals amidst noise.</p>
<p>Low vision condition: to simulate low vision, the activation levels of the stimuli were reduced. Unlike the range from 0.0 to 1.0 used in pre-training, the stimuli’s activation levels were adjusted to span from 0.0 to 0.3. This condition examined the network’s capability to recognize stimuli with diminished intensity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">factor</span><span class="o">=</span><span class="mi">2</span>
<span class="c1"># Compare your results with the patterns generate below</span>
<span class="n">set_1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_patterns</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>
<span class="n">set_2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_patterns</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>
<span class="n">set_3</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_patterns</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">plot_signal_max_and_indicator</span><span class="p">(</span><span class="n">set_1</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="s2">"Suprathreshold dataset"</span><span class="p">)</span>
<span class="n">plot_signal_max_and_indicator</span><span class="p">(</span><span class="n">set_2</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="s2">"Subthreshold dataset"</span><span class="p">)</span>
<span class="n">plot_signal_max_and_indicator</span><span class="p">(</span><span class="n">set_3</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="s2">"Low Vision dataset"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="activity-1-building-a-network-for-a-blindsight-situation">
<h3>Activity 1: Building a network for a blindsight situation<a class="headerlink" href="#activity-1-building-a-network-for-a-blindsight-situation" title="Permalink to this heading">#</a></h3>
<p>In this activity, we’ll construct a neural network model using our auto-generated dataset, focusing on blindsight scenarios. The model will primarily consist of fully connected layers, establishing a straightforward, first-order network. The aim here is to assess the basic network’s performance.</p>
<p><strong>Steps to follow</strong></p>
<ol class="arabic simple">
<li><p>Examine the network architecture: understand the structure of the neural network you’re about to work with.</p></li>
<li><p>Visualize loss metrics: observe and analyze the network’s performance during pre-training by visualizing the loss over epochs.</p></li>
<li><p>Evaluate the model: use the provided code snippets to calculate and interpret the model’s accuracy, recall, and F1-score, giving you insight into the network’s capabilities.</p></li>
</ol>
<p><strong>Understanding the process</strong></p>
<p>The goal is to gain a thorough comprehension of the network’s architecture and to interpret the pre-training results visually. This will provide a clearer picture of the model’s potential and limitations.</p>
<p>The network is designed as a backpropagation autoassociator. It features a 100-unit input layer, directly linked to a 40-unit hidden layer, which in turn connects to a 100-unit output layer. Initial connection weights are set within the range of -1.0 to 1.0 for the first-order network. To mitigate overfitting, dropout is employed within the network architecture. The architecture includes a configurable activation function. This flexibility allows for adjustments and tuning in Activity 3, aiming for optimal model performance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">FirstOrderNetwork</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hidden_units</span><span class="p">,</span> <span class="n">data_factor</span><span class="p">,</span> <span class="n">use_gelu</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initializes the FirstOrderNetwork with specific configurations.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - hidden_units (int): The number of units in the hidden layer.</span>
<span class="sd">        - data_factor (int): Factor to scale the amount of data processed.</span>
<span class="sd">                             A factor of 1 indicates the default data amount,</span>
<span class="sd">                             while 10 indicates 10 times the default amount.</span>
<span class="sd">        - use_gelu (bool): Flag to use GELU (True) or ReLU (False) as the activation function.</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FirstOrderNetwork</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Define the encoder, hidden, and decoder layers with specified units</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">hidden_units</span><span class="p">,</span> <span class="n">bias</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Encoder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_units</span><span class="p">,</span> <span class="n">hidden_units</span><span class="p">,</span> <span class="n">bias</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Hidden</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_units</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">bias</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Decoder</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmoid</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">()</span>


        <span class="c1"># Dropout layer to prevent overfitting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="c1"># Set the data factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_factor</span> <span class="o">=</span> <span class="n">data_factor</span>

        <span class="c1"># Other activation functions for various purposes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Softmax</span><span class="p">()</span>

        <span class="c1"># Initialize network weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_weights</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">initialize_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Initializes weights of the encoder, hidden, and decoder layers uniformly."""</span>
        <span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
      <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">))))</span>
      <span class="k">return</span> <span class="n">h1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
      <span class="c1">#h2 = self.relu(self.hidden(z))</span>
      <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">h2</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">      </span><span class="sd">"""</span>
<span class="sd">      Defines the forward pass through the network.</span>

<span class="sd">      Parameters:</span>
<span class="sd">      - x (Tensor): The input tensor to the network.</span>

<span class="sd">      Returns:</span>
<span class="sd">      - Tensor: The output of the network after passing through the layers and activations.</span>
<span class="sd">      """</span>
      <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">h1</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">h1</span> <span class="p">,</span> <span class="n">h2</span>
</pre></div>
</div>
</div>
</div>
<p>For now, we will train the first order network only.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the architecture, optimizers, loss functions, and schedulers for pre training</span>
<span class="c1"># Hyperparameters</span>

<span class="c1"># Hyperparameters</span>
<span class="k">global</span> <span class="n">optimizer</span> <span class="p">,</span><span class="n">n_epochs</span> <span class="p">,</span> <span class="n">learning_rate_1</span>
<span class="n">learning_rate_1</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">optimizer</span><span class="o">=</span><span class="s2">"ADAMAX"</span>
<span class="n">hidden</span><span class="o">=</span><span class="mi">40</span>
<span class="n">factor</span><span class="o">=</span><span class="mi">2</span>
<span class="n">gelu</span><span class="o">=</span><span class="kc">False</span>
<span class="n">gam</span><span class="o">=</span><span class="mf">0.98</span>
<span class="n">meta</span><span class="o">=</span><span class="kc">True</span>
<span class="n">stepsize</span><span class="o">=</span><span class="mi">25</span>
<span class="n">initialize_global</span><span class="p">()</span>


<span class="c1"># Networks instantiation</span>
<span class="n">first_order_network</span> <span class="o">=</span> <span class="n">FirstOrderNetwork</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span><span class="n">factor</span><span class="p">,</span><span class="n">gelu</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">second_order_network</span> <span class="o">=</span> <span class="n">SecondOrderNetwork</span><span class="p">(</span><span class="n">gelu</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="c1"># We define it, but won't use it until activity 3</span>

<span class="c1"># Loss function</span>
<span class="n">criterion_1</span> <span class="o">=</span> <span class="n">CAE_loss</span>

<span class="c1"># Optimizer</span>
<span class="n">optimizer_1</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adamax</span><span class="p">(</span><span class="n">first_order_network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_1</span><span class="p">)</span>

<span class="c1"># Learning rate schedulers</span>
<span class="n">scheduler_1</span> <span class="o">=</span> <span class="n">StepLR</span><span class="p">(</span><span class="n">optimizer_1</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">stepsize</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gam</span><span class="p">)</span>

<span class="n">max_values_output_first_order</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">max_indices_output_first_order</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">max_values_patterns_tensor</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">max_indices_patterns_tensor</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Training loop</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">):</span>
    <span class="c1"># Generate training patterns and targets for each epoch.</span>
    <span class="n">patterns_tensor</span><span class="p">,</span> <span class="n">stim_present_tensor</span><span class="p">,</span> <span class="n">stim_absent_tensor</span><span class="p">,</span> <span class="n">order_2_tensor</span> <span class="o">=</span> <span class="n">generate_patterns</span><span class="p">(</span><span class="n">patterns_number</span><span class="p">,</span> <span class="n">num_units</span><span class="p">,</span><span class="n">factor</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Forward pass through the first-order network</span>
    <span class="n">hidden_representation</span> <span class="p">,</span> <span class="n">output_first_order</span> <span class="o">=</span> <span class="n">first_order_network</span><span class="p">(</span><span class="n">patterns_tensor</span><span class="p">)</span>

    <span class="n">output_first_order</span><span class="o">=</span><span class="n">output_first_order</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Skip computations for the second-order network</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>

        <span class="c1"># Potentially forward pass through the second-order network without tracking gradients</span>
        <span class="n">output_second_order</span> <span class="o">=</span> <span class="n">second_order_network</span><span class="p">(</span><span class="n">patterns_tensor</span><span class="p">,</span> <span class="n">output_first_order</span><span class="p">)</span>

    <span class="c1"># Calculate the loss for the first-order network (accuracy of stimulus representation)</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">first_order_network</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()[</span><span class="s1">'fc1.weight'</span><span class="p">]</span>
    <span class="n">loss_1</span> <span class="o">=</span> <span class="n">criterion_1</span><span class="p">(</span> <span class="n">W</span><span class="p">,</span> <span class="n">stim_present_tensor</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">output_first_order</span><span class="p">,</span>
                        <span class="n">hidden_representation</span><span class="p">,</span> <span class="n">lam</span> <span class="p">)</span>
    <span class="c1"># Backpropagate the first-order network's loss</span>
    <span class="n">loss_1</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

    <span class="c1"># Update first-order network weights</span>
    <span class="n">optimizer_1</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

    <span class="c1"># Reset first-order optimizer gradients to zero for the next iteration</span>

    <span class="c1"># Update the first-order scheduler</span>
    <span class="n">scheduler_1</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

    <span class="n">epoch_1_order</span><span class="p">[</span><span class="n">epoch</span><span class="p">]</span> <span class="o">=</span> <span class="n">loss_1</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

    <span class="c1"># Get max values and indices for output_first_order</span>
    <span class="n">max_vals_out</span><span class="p">,</span> <span class="n">max_inds_out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">output_first_order</span><span class="p">[</span><span class="mi">100</span><span class="p">:],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">max_inds_out</span><span class="p">[</span><span class="n">max_vals_out</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_values_output_first_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_vals_out</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">max_indices_output_first_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_inds_out</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="c1"># Get max values and indices for patterns_tensor</span>
    <span class="n">max_vals_pat</span><span class="p">,</span> <span class="n">max_inds_pat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">patterns_tensor</span><span class="p">[</span><span class="mi">100</span><span class="p">:],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">max_inds_pat</span><span class="p">[</span><span class="n">max_vals_pat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_values_patterns_tensor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_vals_pat</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">max_indices_patterns_tensor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_inds_pat</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>


<span class="n">max_values_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_values_output_first_order</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">max_indices_output_first_order</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">max_values_patterns_tensor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">max_indices_patterns_tensor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>


<span class="c1"># Plot training loss curve</span>
<span class="n">pre_train_plots</span><span class="p">(</span><span class="n">epoch_1_order</span><span class="p">,</span> <span class="n">epoch_2_order</span><span class="p">,</span> <span class="s2">"1st &amp; 2nd Order Networks"</span> <span class="p">,</span> <span class="n">max_value_indices</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="testing-under-3-blindsight-conditions">
<h3>Testing under 3 blindsight conditions<a class="headerlink" href="#testing-under-3-blindsight-conditions" title="Permalink to this heading">#</a></h3>
<p>We will now use the testing auto-generated datasets from activity 1 to test the network’s performance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_seed</span><span class="o">=</span><span class="p">[]</span>
<span class="n">discrimination_seed</span><span class="o">=</span><span class="p">[]</span>

<span class="c1"># Prepare networks for testing by calling the configuration function</span>
<span class="n">testing_patterns</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">loaded_model</span><span class="p">,</span> <span class="n">loaded_model_2</span> <span class="o">=</span> <span class="n">config_training</span><span class="p">(</span><span class="n">first_order_network</span><span class="p">,</span> <span class="n">second_order_network</span><span class="p">,</span> <span class="n">hidden</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">gelu</span><span class="p">)</span>

<span class="c1"># Perform testing using the defined function and plot the results</span>
<span class="n">f1_scores_wager</span><span class="p">,</span> <span class="n">mse_losses_indices</span> <span class="p">,</span> <span class="n">mse_losses_values</span> <span class="p">,</span> <span class="n">discrimination_performances</span><span class="p">,</span> <span class="n">results_for_plotting</span> <span class="o">=</span> <span class="n">testing</span><span class="p">(</span><span class="n">testing_patterns</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">loaded_model</span><span class="p">,</span> <span class="n">loaded_model_2</span><span class="p">,</span><span class="n">factor</span><span class="p">)</span>

<span class="n">results_seed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results_for_plotting</span><span class="p">)</span>
<span class="n">discrimination_seed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">discrimination_performances</span><span class="p">)</span>
<span class="c1"># Assuming plot_testing is defined, call it to display results</span>
<span class="n">plot_testing</span><span class="p">(</span><span class="n">results_seed</span><span class="p">,</span><span class="n">discrimination_seed</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s2">"Seed"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id20">
<h4>Submit your feedback<a class="headerlink" href="#id20" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_First_order_network"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
</section>
<hr class="docutils"/>
<section id="bonus-coding-section-2-plot-surfaces-for-content-awareness-inferences">
<h2>Bonus coding section 2: Plot surfaces for content / awareness inferences<a class="headerlink" href="#bonus-coding-section-2-plot-surfaces-for-content-awareness-inferences" title="Permalink to this heading">#</a></h2>
<p>To explore the properties of the HOSS model, we can simulate inference at different levels of the hierarchy over the full 2D space of possible input X’s. The left panel below shows that the probability of awareness (of any stimulus contents) rises in a graded manner from the lower left corner of the graph (low activation of any feature) to the upper right (high activation of both features). In contrast, the right panel shows that confidence in making a discrimination response (e.g. rightward vs. leftward) increases away from the major diagonal, as the model becomes sure that the sample was generated by either a leftward or rightward tilted stimulus.</p>
<p>Together, the two surfaces make predictions about the relationships we might see between discrimination confidence and awareness in a simple psychophysics experiment. One notable prediction is that discrimination could still be possible - and lead to some degree of confidence - even when the higher-order node is “reporting” unawareness of the stimulus.</p>
<p>Now, let’s get hands on and plot those auto-generated patterns!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the grid</span>
<span class="n">xgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>

<span class="c1"># Define the means for the Gaussian distributions</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>

<span class="c1"># Define the covariance matrix</span>
<span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

<span class="c1"># Prior probabilities</span>
<span class="n">Wprior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">Aprior</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># Initialize arrays to hold confidence and posterior probability</span>
<span class="n">confW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)))</span>
<span class="n">posteriorAware</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)))</span>
<span class="n">KL_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)))</span>
<span class="n">KL_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)))</span>

<span class="c1"># Compute confidence and posterior probability for each point in the grid</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">xgrid</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">'Outer Loop'</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">xj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xgrid</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span><span class="p">,</span> <span class="n">xj</span><span class="p">]</span>
        <span class="n">post_w</span><span class="p">,</span> <span class="n">post_A</span><span class="p">,</span> <span class="n">KL_w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">KL_A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">HOSS_evaluate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">Aprior</span><span class="p">,</span> <span class="n">Wprior</span><span class="p">)</span>
        <span class="n">confW</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">post_w</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">post_w</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">posteriorAware</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">post_A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">():</span>

    <span class="c1"># Plotting</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Posterior probability "seen"</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">,</span> <span class="n">posteriorAware</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X1'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'X2'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Posterior probability "seen"'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'square'</span><span class="p">)</span>

    <span class="c1"># Confidence in identity</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">contour_set</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">,</span> <span class="n">confW</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">,</span> <span class="n">posteriorAware</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">'white'</span><span class="p">])</span>  <span class="c1"># Line contour for threshold</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X1'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'X2'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Confidence in identity'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'square'</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Simulate KL-divergence surfaces</strong></p>
<p>We can also simulate KL-divergences (a measure of Bayesian surprise) at each layer in the network, which under predictive coding models of the brain, has been proposed to scale with neural activation (e.g., Friston, 2005; Summerfield &amp; de Lange, 2014).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the grid</span>
<span class="n">xgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>

<span class="c1"># Define the means for the Gaussian distributions</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>

<span class="c1"># Define the covariance matrix</span>
<span class="n">Sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

<span class="c1"># Prior probabilities</span>
<span class="n">Wprior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">Aprior</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># Initialize arrays to hold confidence and posterior probability</span>
<span class="n">confW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)))</span>
<span class="n">posteriorAware</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)))</span>
<span class="n">KL_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)))</span>
<span class="n">KL_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)))</span>

<span class="c1"># Compute confidence and posterior probability for each point in the grid</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xgrid</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">xj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xgrid</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span><span class="p">,</span> <span class="n">xj</span><span class="p">]</span>
        <span class="n">post_w</span><span class="p">,</span> <span class="n">post_A</span><span class="p">,</span> <span class="n">KL_w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">KL_A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">HOSS_evaluate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">Aprior</span><span class="p">,</span> <span class="n">Wprior</span><span class="p">)</span>

        <span class="n">confW</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">post_w</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">post_w</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">posteriorAware</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">post_A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Calculate the mean K-L divergence for absent and present awareness states</span>
<span class="n">KL_A_absent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">KL_A</span><span class="p">[</span><span class="n">posteriorAware</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">KL_A_present</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">KL_A</span><span class="p">[</span><span class="n">posteriorAware</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">KL_w_absent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">KL_w</span><span class="p">[</span><span class="n">posteriorAware</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">KL_w_present</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">KL_w</span><span class="p">[</span><span class="n">posteriorAware</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">])</span>

<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">():</span>

    <span class="c1"># Plotting</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># K-L divergence, perceptual states</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">,</span> <span class="n">KL_w</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'viridis'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X1'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'X2'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'KL-divergence, perceptual states'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'square'</span><span class="p">)</span>

    <span class="c1"># K-L divergence, awareness state</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">,</span> <span class="n">KL_A</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'viridis'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X1'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'X2'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'KL-divergence, awareness state'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'square'</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="id21">
<h3>Discussion point<a class="headerlink" href="#id21" title="Permalink to this heading">#</a></h3>
<p>Can you recognise the difference between the KL divergence for the W-level and the one for the A-level?</p>
<p><a class="reference external" href="https://github.com/neuromatch/NeuroAI_Course/tree/main/tutorials/W2D5_Mysteries/solutions/W2D5_Tutorial1_Solution_f903bbb4.py"><em>Click for solution</em></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">():</span>

    <span class="c1"># Create figure with specified size</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># KL divergence for W states</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="s1">'unseen'</span><span class="p">,</span> <span class="s1">'seen'</span><span class="p">],</span> <span class="p">[</span><span class="n">KL_w_absent</span><span class="p">,</span> <span class="n">KL_w_present</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'KL divergence, W states'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="c1"># KL divergence for A states</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="s1">'unseen'</span><span class="p">,</span> <span class="s1">'seen'</span><span class="p">],</span> <span class="p">[</span><span class="n">KL_A_absent</span><span class="p">,</span> <span class="n">KL_A_present</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'KL divergence, A states'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Show plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="id22">
<h4>Submit your feedback<a class="headerlink" href="#id22" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_HOSS_Bonus_Content"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
</section>
</section>
<hr class="docutils"/>
<section class="tex2jax_ignore mathjax_ignore" id="discussion-bonus-section">
<h1>Discussion Bonus Section<a class="headerlink" href="#discussion-bonus-section" title="Permalink to this heading">#</a></h1>
<p>This section contains an extra discussion exercise if you have time and inclination.</p>
<p>In this bonus section, Megan and Anil will delve into the complexities of defining and testing for consciousness, particularly in the context of artificial intelligence. We will explore various theoretical perspectives, examine classic and contemporary tests for consciousness, and discuss the challenges and ethical implications of determining whether a system truly possesses conscious experience.</p>
<section id="video-11-consciousness-bonus-content">
<h2>Video 11: Consciousness Bonus Content<a class="headerlink" href="#video-11-consciousness-bonus-content" title="Permalink to this heading">#</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
</section>
<section id="id23">
<h2>Submit your feedback<a class="headerlink" href="#id23" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Video_11"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="discussion-activity-is-it-actually-conscious">
<h2>Discussion activity: Is it actually conscious?<a class="headerlink" href="#discussion-activity-is-it-actually-conscious" title="Permalink to this heading">#</a></h2>
<p>We discussed the difference between these two…</p>
<ul class="simple">
<li><p>“Forward” tests: passing means the machine is conscious (or intelligent).</p></li>
<li><p>“Reverse” tests: passing means humans are convinced that a machine is conscious (or intelligent).</p></li>
</ul>
<p><strong>Discuss!</strong> If a system (AI, other animal, other human) exhibited all the “right signs” of being conscious, how can we know for sure it is actually conscious? How could you design a test to be a true forward test?</p>
<ul class="simple">
<li><p>Room 1: I think you could design a forward test in this way… [share your ideas]</p></li>
<li><p>Room 2: I think a forward test is impossible, and here’s why [share your ideas]</p></li>
</ul>
<section id="id24">
<h3>Submit your feedback<a class="headerlink" href="#id24" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Submit your feedback</span>
<span class="n">content_review</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">feedback_prefix</span><span class="si">}</span><span class="s2">_Discussion_activity"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
</section>
<script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./tutorials/W2D5_Mysteries/student"
        },
        predefinedOutput: true
    }
    </script>
<script>kernelName = 'python3'</script>
</article>
<footer class="bd-footer-article">
<!-- Previous / next buttons -->
<div class="prev-next-area">
<a class="left-prev" href="W2D5_Intro.html" id="prev-link" title="previous page">
<i class="fa-solid fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">Intro</p>
</div>
</a>
<a class="right-next" href="W2D5_Tutorial2.html" id="next-link" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">Tutorial 2: Ethics</p>
</div>
<i class="fa-solid fa-angle-right"></i>
</a>
</div>
</footer>
</div>
<div class="bd-sidebar-secondary bd-toc">
<div class="toc-item">
<div class="tocsection onthispage">
<i class="fa-solid fa-list"></i> On this page
</div>
<nav class="page-toc" id="bd-toc-nav">
<ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#">
   Tutorial 1: Consciousness
  </a>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#tutorial-objectives">
   Tutorial Objectives
  </a>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#setup">
   Setup
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#install-and-import-feedback-gadget">
     Install and import feedback gadget
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#import-dependencies">
     Import dependencies
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#figure-settings">
     Figure settings
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#helper-functions">
     Helper functions
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#plotting-functions">
     Plotting functions
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#set-device-gpu-or-cpu">
     Set device (GPU or CPU)
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-1-global-neuronal-workspace">
   Section 1: Global Neuronal Workspace
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-1-global-neuronal-workspace">
     Video 1: Global Neuronal Workspace
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#submit-your-feedback">
     Submit your feedback
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-2-global-neuronal-workspace">
     Video 2: Global Neuronal Workspace
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id1">
     Submit your feedback
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-1a-modularity-of-the-mind">
     Section 1a: Modularity Of The Mind
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-3-modularity-of-the-mind">
       Video 3: Modularity Of The Mind
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id2">
       Submit your feedback
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#rims">
       RIMs
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#data-retrieval">
         Data retrieval
        </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id3">
         Submit your feedback
        </a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#discussion-point">
       Discussion point
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id4">
         Submit your feedback
        </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-1b-a-shared-workspace">
     Section 1b: A Shared Workspace
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-4-a-shared-workspace">
       Video 4: A Shared Workspace
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id5">
       Submit your feedback
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise-1-creating-a-shared-workspace">
       Coding Exercise 1: Creating a Shared Workspace
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id6">
         Submit your feedback
        </a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#section-2-higher-order-assessment-and-metacognition">
   Section 2: Higher order assessment and metacognition
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-5-higher-order-assessment-and-metacognition">
     Video 5: Higher order assessment and metacognition
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id7">
     Submit your feedback
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#second-order-model">
     Second order model
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise-2-developing-a-second-order-network">
       Coding Exercise 2: Developing a Second-Order Network
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id8">
         Submit your feedback
        </a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id9">
       Discussion point
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id10">
         Submit your feedback
        </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-6-second-order-network">
         Video 6: Second Order Network
        </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id11">
         Submit your feedback
        </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#higher-order-state-space-hoss-model">
     Higher Order State Space (HOSS) model
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-7-higher-order-state-spaces">
       Video 7: Higher-Order State Spaces
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id12">
       Submit your feedback
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#model-inference">
       Model inference
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-exercise">
       Coding exercise
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id13">
         Submit your feedback
        </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id14">
         Submit your feedback
        </a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id15">
       Discussion point
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id16">
         Submit your feedback
        </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-8-outro-ignition">
         Video 8: Outro - Ignition
        </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id17">
         Submit your feedback
        </a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#summary">
   Summary
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-9-final-thoughts">
     Video 9: Final Thoughts
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id18">
     Submit your feedback
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-10-final-thoughts">
     Video 10: Final Thoughts
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id19">
     Submit your feedback
    </a>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#coding-bonus-section">
   Coding Bonus Section
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#bonus-coding-exersice-1-train-a-first-order-network">
     Bonus coding exersice 1: Train a first-order network
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#activity-1-building-a-network-for-a-blindsight-situation">
       Activity 1: Building a network for a blindsight situation
      </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#testing-under-3-blindsight-conditions">
       Testing under 3 blindsight conditions
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id20">
         Submit your feedback
        </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#bonus-coding-section-2-plot-surfaces-for-content-awareness-inferences">
     Bonus coding section 2: Plot surfaces for content / awareness inferences
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id21">
       Discussion point
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id22">
         Submit your feedback
        </a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry">
<a class="reference internal nav-link" href="#discussion-bonus-section">
   Discussion Bonus Section
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#video-11-consciousness-bonus-content">
     Video 11: Consciousness Bonus Content
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id23">
     Submit your feedback
    </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#discussion-activity-is-it-actually-conscious">
     Discussion activity: Is it actually conscious?
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id24">
       Submit your feedback
      </a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
<footer class="bd-footer-content">
<div class="bd-footer-content__inner">
<div class="bd-footer-content__inner container">
<div class="footer-item">
<p class="component-author">
By Neuromatch
</p>
</div>
<div class="footer-item">
</div>
<div class="footer-item">
<p class="last-updated">
Last updated on None.<br/>
</p>
</div>
<div class="footer-item">
<div class="extra_footer">
<div>
<a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://i.creativecommons.org/l/by/4.0/88x31.png"/></a>
<a href="https://opensource.org/licenses/BSD-3-Clause"><img src="https://camo.githubusercontent.com/9b9ea65d95c9ef878afa1987df65731d47681336/68747470733a2f2f696d672e736869656c64732e696f2f707970692f6c2f736561626f726e2e737667"/></a>
The contents of this repository are shared under the <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
Software elements are additionally licensed under the <a href="https://opensource.org/licenses/BSD-3-Clause">BSD (3-Clause) License</a>.
</div>
</div>
</div>
</div>
</div>
</footer>
</main>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>
</body>
</html>